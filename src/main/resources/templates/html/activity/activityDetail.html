<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<th:block th:replace="common/head.html"/>
	<link rel="stylesheet" href="/css/manageAct.css">
	<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f0794c5090c6554a68e453d22b1837f5&libraries=services"></script>
	<style th:inline="text">
		.multiselect {
			width: 200px;
		}

		.selectBox {
			position: relative;
		}

		.selectBox select {
			width: 100%;
			font-weight: bold;
		}

		.overSelect {
			position: absolute;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
		}

		#users {
			display: none;
			border: 1px #dadada solid;
			max-height:100px;/* you can change as you need it */
			overflow:auto;/* to get scroll */
		}

		#volunteers {
			display: none;
			border: 1px #dadada solid;
			max-height:100px;/* you can change as you need it */
			overflow:auto;/* to get scroll */
		}
		hr {
			border: 0.5px solid #e6e6e6;
		}
		.edit {
			margin-right: 15px;
		}
		#deadline, #volunteerTime, #content, #place, #delivery {
			color: #494949;
			font-size: 16px;
			font-weight: 400;
		}
		.user_left {
			float: left;
			width: 50%;
		}
		.user_right {
			float: left;
			width: 50%;
		}
		.worker, .user {
			float: left;
		}
		.members {
			width: 150px;
		}
		#clickedUsers, #clickedVolunteers, #users, #volunteers {
			font-size: 14px;
			color: #494949;
		}
		#clickedUsers > li {
			margin-top: 5px;
			background: #EDFAF3;
			border-radius: 10px;
			width: 200px;
		}
		#clickedVolunteers > li {
			margin-top: 5px;
			border-radius: 10px;
			width: 200px;
		}
		#clickedVolunteers > .list-group-item-warning {
			background: #F4FAE5
		}
		#clickedVolunteers > .list-group-item-success {
			background: #EDFAF3;
		}
		#clickedVolunteers > .list-group-item-danger {
			background: #FAEDE6
		}
		#sign {
			color: #494949;
		}
		@media (max-width:1170px){
			#activity_map {
				width: 60%;
				margin-left: -15px;
			}
			#product_picture {
				width: 60%;
				margin-top: 30px;
			}
		}
		.fancybox-content {
			width: 65%;
			height: 65%;
			padding: 0px;
			border-radius: 20px;
			text-align: left;
		}
		.v_menuname{
			color: #494949;
			font-weight: normal;
			font-size: 16px;
			clear: both;
			margin: 10px 10px 0 0;
			width: 140px;
		}
		.v_menuval {
			margin-top: 10px;
		}
		.fancybox-button svg {
			width: 48px;
			height: 48px;
			right: 25px;
			top: -5px;
		}
	</style>
</head>
<body>
	<header th:replace="common/menu :: header"></header>

	<div lang="en" th:replace="common/menu :: menu"></div>

	<div id="main">

		<div id="message" style="display: none" class="alert alert-info alert-dismissible fade show mt-3" role="alert">
			<span id="mContent">메시지</span>
			<button onclick="hideMessage()" type="button" class="close" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>

		<h4>활동 상세</h4>

		<input type="hidden" id="activityId" th:value="${activityDto.id}"/>

		<div>
		<div id="activity_bar" class="bar">
			<div class="heading" id="titleText" th:text="${activityDto.title}"></div>
			<input id="editTitleField" type="text" th:value="${activityDto.title}" style="display: none;">

			<div id="status" th:with="condition=${activityDto.status}">
				<!--매칭 전 -->
				<span id="status0" th:if="${condition == 0}">
					<img class="tag" src="/img/before_matching.png">
				</span>
				<span id="status0" th:if="${condition != 0 and condition lt 5}">
					<img th:id="0" class="untag" src="/img/b_matching.png" onclick="changeStatus(event)">
				</span>

				<!-- 매칭 중 -->
				<span id="status1" th:if="${condition == 1}"><img class="tag" src="/img/ing_matching.png"></span>
				<span id="status1" th:if="${condition != 1 and condition lt 5}"><img th:id="1" class="untag" src="/img/matching.png" onclick="changeStatus(event)"></span>

				<!-- 매칭 완료 -->
				<span id="status2" th:if="${condition == 2}"><img class="tag" src="/img/done_matching.png"></span>
				<span id="status2" th:if="${condition != 2 and condition lt 5}"><img th:id="2" class="untag" src="/img/a_matching.png" onclick="changeStatus(event)"></span>

				<!-- 활동 중 -->
				<span id="status3" th:if="${condition == 3}"><img class="tag" src="/img/ing_activity.png"></span>
				<span id="status3" th:if="${condition != 3 and condition lt 5}"><img th:id="3" class="untag" src="/img/activiting.png" onclick="changeStatus(event)"></span>

				<!-- 활동 완료 -->
				<span id="status4" th:if="${condition == 4}"><img class="tag" src="/img/done_activity.png"></span>
				<span id="status4" th:if="${condition != 4 and condition lt 5}"><img th:id="4" class="untag" src="/img/a_activiting.png" onclick="changeStatus(event)"></span>

				<!-- 취소된 활동 -->
				<span id="status5" th:if="${condition == 5}"><img class="tag" src="/img/cancle_activity.png"></span>

				<!-- 물건 거절 -->
				<span id="status6" th:if="${condition == 6}"><img class="tag" src="/img/tag_thing.png"></span>

			</div>


<!--			<span id="status" th:if="${activityDto.status == 0}"><img id="tag" src="/img/before_matching.png"></span>-->
<!--			<span id="status" th:if="${activityDto.status == 1}"><img id="tag" src="/img/ing_matching.png"></span>-->
<!--			<span id="status" th:if="${activityDto.status == 2}"><img id="tag" src="/img/done_matching.png"></span>-->
<!--			<span id="status" th:if="${activityDto.status == 3}"><img id="tag" src="/img/ing_activity.png"></span>-->
<!--			<span id="status" th:if="${activityDto.status == 4}"><img id="tag" src="/img/done_activity.png"></span>-->
<!--			<span id="status" th:if="${activityDto.status == 5}"><img id="tag" src="/img/cancle_activity.png"></span>-->

			<select id="editStatus" style="display: none;">
				<option th:value="0" th:selected="${activityDto.status} == 0">매칭 전</option>
				<option th:value="1" th:selected="${activityDto.status} == 1">매칭 중</option>
				<option th:value="2" th:selected="${activityDto.status} == 2">매칭 완료</option>
				<option th:value="3" th:selected="${activityDto.status} == 3">활동 진행 중</option>
				<option th:value="4" th:selected="${activityDto.status} == 4">활동 완료</option>
				<option th:value="5" th:selected="${activityDto.status} == 5">취소된 활동</option>
				<option th:if="${activityDto.interestCategory?.name?.contains('물건')}" th:value="6" th:selected="${activityDto.status} == 6">물건 거절</option>
			</select>

			<button id="editTitleGroupBtn" class="inlinebox edit" style="padding-top: 6px">편집</button>
			<button id="cancelTitleGroupBtn" class="inlinebox edit" style="display: none;padding-top: 6px">취소</button>
		</div>

		<div id="actManage" style="border-radius: 0px 0px 15px 15px">
			<div class="row1">
				<div class="endtimemenu inlinebox" style="width:50%">
					<div class="inlinebox">
						<div class="sub_heading">카테고리</div>
					</div>
					<input type="text" id="category" name="category" th:value="${activityDto.interestCategory?.name}" style="margin-left: 10px;" disabled>

					<select id="editCategory" style="display: none;">
						<option value="0">관심사를 선택하세요</option>
						<option th:each="interest : ${interests}" th:value="${interest.id}"
								th:text="${interest.name}"
								th:selected="${interest.id} == ${activityDto.interestCategory?.id}"></option>
					</select>
				</div>
				<div class="endtimemenu inlinebox" style="margin-left: -10px">
					<div class="inlinebox">
						<div class="sub_heading">마감기한</div>
					</div>
					<div class="inlinebox">
						<p id="deadline" th:if="${activityDto.deadline==null}" style="display: inline;">마감시간 없음</p>
						<p id="deadline" th:if="${activityDto.deadline}" style="display: inline">[[${#temporals.format(activityDto.deadline, 'yyyy-MM-dd HH:mm')}]]</p>
						<div id="editDeadline" style="display: none;">
							<input id="enddate" type="date" name="deadlineDate" th:value="${activityDto.deadline?.toLocalDate()}" style="width: 125px">
							<input id="endtime" type="time" name="deadlineTime" th:value="${activityDto.deadline?.toLocalTime()}" style="width: 95px">
						</div>
					</div>
				</div>
				<button th:if="${activityDto.status} == 0" id="editCategoryGroupBtn" class="edit">편집</button>
				<button id="cancelCategoryGroupBtn" class="edit" style="display: none;">취소</button>
			</div>

			<hr class="line">

			<div class="sub_contentbox">
				<div class="sub_heading">담당 인원</div>
				<button th:if="${activityDto.status} <= 1" id="editUserGroupBtn" class="edit">편집</button>
				<button id="cancelUserGroupBtn" class="edit" style="display: none;">취소</button>
				<div>
					<div class="inlinebox" style="width: 100px">
						<div class="menu_name">담당 관제사</div>
					</div>
					<div class="inlinebox">
						<div id="admin_background" class="members charge">
							<span th:if="${activityDto.manager == null}" id="manager">관리자 없음</span>
							<span th:if="${activityDto.manager != null}" id="manager" th:text="${activityDto.manager?.name}"></span>
							<select id="editManager" style="display: none;margin-left: -20px;">
								<option value="0">관리자를 선택하세요</option>
								<option th:each="manager : ${managers}" th:value="${manager.id}" th:text="${manager.name}" th:selected="${manager.id} == ${activityDto.manager?.id}"></option>
							</select>
						</div>
					</div>
				</div>
				<div class="user_left" style="margin-bottom: 15px">
<!--					<div class="inlinebox" style="width: 100px">-->
						<div class="menu_name workertext" style="width: 83px">이용자</div>
<!--					</div>-->
					<div class="workerblock" style="width: 80%">
					<div class="inlinebox">
						<div id="userList" class="members user" th:if="${activityDto.activityUsers.size()} == 0" style="display:inline;">
							이용자 없음
						</div>

						<div id="userList" th:if="${activityDto.activityUsers.size()} > 0">
							<div class="members user" th:each="activityUser : ${activityDto.activityUsers}">
								<input type="hidden" class="userIds" th:value="${activityUser.user?.id}"/>
								<a th:text="${activityUser.user?.name}" data-fancybox th:data-src="${'#userDetail' + activityUser.user?.id}" href="javascript:;"></a>
<!--								<span th:text="${activityUser.user?.name}"></span>-->
								<span th:text="${activityUser.user?.phone}"></span>
								<div style="display: none;" th:id="${'userDetail' + activityUser.user?.id}">
									<img src="/img/v_bar.png">
									<h3 style="padding-left: 20px">이용자 정보</h3>
									<div style="padding-left: 20px">
										<div class="sub_heading">
											기본 정보
										</div>
										<div>
											<div class="user_left" style="width: 100%;">
												<div class="inlinebox">
													<div class="v_menuname" style="float: left;">
														이름
													</div>
													<input type="text" class="v_menuval" id="v_name" name="v_name" th:value="${activityUser.user.name}" disabled>
												</div>
												<br>
												<div class="inlinebox">
													<div class="v_menuname" style="float: left;">
														전화번호
													</div>
													<input type="text" class="v_menuval" id="v_phone" name="v_phone" th:value="${activityUser.user.phone}" disabled>
												</div>
												<br>
												<div class="inlinebox">
													<div class="v_menuname" style="float: left;">
														이메일
													</div>
													<input type="text" class="v_menuval" id="v_phone" name="v_email" th:value="${activityUser.user.socialId}" style="width: 200px" disabled>
												</div>
												<br>
												<div class="inlinebox">
													<div class="v_menuname" style="float: left;">
														관심사
													</div>
													<span th:each="interest : ${activityUser.userInterestList}">
														<input type="text" th:id="interest+${interest.id}" class="v_menuval" name="interests" th:value="${interest.name}" disabled>
													</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div id="editUsers" style="display: none;">
							<div class="multiselect">
								<div class="selectBox" onclick="showUserCheckboxes()">
									<select style="width: 120px;padding: 0px">
										<option>이용자를 선택하세요</option>
									</select>
									<div class="overSelect"></div>
								</div>
								<input id="searchUsers" type="text" placeholder="유저 이름으로 검색" style="height:99.5%; width: 200px; display: none;padding: 0px">
								<ul id="users" style="list-style-type: none;">

								</ul>
							</div>
							<ul style="display:none;" id="clickedUsers" class="list-group mt-2">
							</ul>
						</div>
					</div>
					</div>
				</div>

				<div class="user_right" style="margin-bottom: 15px">
					<div class="menu_name workertext" style="width: 83px">봉사자</div>

					<div class="workerblock" style="width: 80%">
						<div class="inlinebox">
							<div id="volunteerList" class="members worker" th:if="${activityDto.activityVolunteers.size()} == 0">
								봉사자 없음
							</div>
							<div id="volunteerList" th:if="${activityDto.activityVolunteers.size()} > 0">
								<div class="members worker" th:each="activityVolunteer : ${activityDto.activityVolunteers}">
									<input type="hidden" class="volunteerIds" th:value="${activityVolunteer.user?.id}"/>
									<div>
										<a th:text="${activityVolunteer.user?.name}" data-fancybox th:data-src="${'#volunteerDetail' + activityVolunteer.user?.id}" href="javascript:;"></a>
										<span th:text="${activityVolunteer.user?.phone}"></span>
										<div style="display: none;" th:id="${'volunteerDetail' + activityVolunteer.user?.id}">
											<img src="/img/v_bar.png">
											<h3 style="padding-left: 20px">봉사자 정보</h3>
											<div style="padding-left: 20px">
												<div class="sub_heading">
													기본 정보
												</div>
												<div>
													<div class="user_left">
														<div class="inlinebox">
															<div class="v_menuname" style="float: left;">
																이름
															</div>
															<input type="text" class="v_menuval" id="v_name" name="v_name" th:value="${activityVolunteer.user.name}" disabled>
														</div>
														<br>
														<div class="inlinebox">
															<div class="v_menuname" style="float: left;">
																전화번호
															</div>
															<input type="text" class="v_menuval" id="v_phone" name="v_phone" th:value="${activityVolunteer.user.phone}" disabled>
														</div>
														<br>
														<div class="inlinebox">
															<div class="v_menuname" style="float: left;">
																상태
															</div>
															<input type="text" class="v_menuval" th:if="${activityVolunteer.status==0}" id="v_status0" name="v_status" value="대기" disabled>
															<input type="text" class="v_menuval" th:if="${activityVolunteer.status==1}" id="v_status1" name="v_status" th:value="승인" disabled>
															<input type="text" class="v_menuval" th:if="${activityVolunteer.status==2}" id="v_status2" name="v_status" th:value="거절" disabled>
														</div>

													</div>
													<div class="user_right">
														<div class="inlinebox">
															<div class="v_menuname" style="float: left;">
																전화번호 공유 동의
															</div>
															<div style="float:left;margin-top: 10px">
																<img style="width: 15px" th:if="${activityVolunteer.phoneAgree == 1}" src="/img/v_ok.png"/>
																<img style="width: 15px" th:if="${activityVolunteer.phoneAgree == 0}" src="/img/v_nok.png"/>
															</div>
														</div>
														<br>
														<div class="inlinebox">
<!--															<div class="v_menuname" style="float: left;">-->
<!--																위치 공유 동의-->
<!--															</div>-->
<!--															<div style="float:left;margin-top: 10px">-->
<!--																<img style="width: 15px" th:if="${activityVolunteer.locationAgree == 1}" src="/img/v_ok.png"/>-->
<!--																<img style="width: 15px" th:if="${activityVolunteer.locationAgree == 0}" src="/img/v_nok.png"/>-->
<!--															</div>-->
														</div>
														<br>
														<div class="inlinebox">
															<div class="v_menuname" style="float: left;">
																봉사 시간
															</div>
															<div style="float: left;margin-top: 10px">
																<span th:id="${'volunteerTime' + activityVolunteer.user?.id}" th:text="${activityVolunteer.volunteerTime}"></span>시간
																<input th:id="${'editVolunteerTime' + activityVolunteer.user?.id}" type="text" style="display:none;width: 75px" th:value="${activityVolunteer.volunteerTime}">
																<button th:id="${'editVolunteerTimeBtn' + activityVolunteer.user?.id}" th:onclick="'javascript:editVolunteerTime(\'' + ${activityVolunteer.user?.id} + '\');'">
																	편집
																</button>
																<button th:id="${'cancelVolunteerTimeBtn' + activityVolunteer.user?.id}" th:onclick="'javascript:cancelVolunteerTime(\'' + ${activityVolunteer.user?.id} + '\');'" style="display: none;">
																	취소
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
											<hr class="line">
											<div style="padding-left: 20px">
												<div class="sub_heading">
													활동 사진
												</div>
												<div>
													<div class="user_left">
														<div class="v_menuname">
															시작 사진
														</div>
														<div>
															<img style="display:block;width: 300px" th:if="${activityVolunteer.startImage}" alt="image" th:src="@{${activityVolunteer.startImage}}" width="300px" height="250px">
															<span th:if="${activityVolunteer.startImage == null}">없음</span>
														</div>
													</div>
													<div class="user_right">
														<div class="v_menuname">
															끝 사진
														</div>
														<div>
															<img style="display:block;width: 300px" th:if="${activityVolunteer.endImage}" alt="image" th:src="@{${activityVolunteer.endImage}}" width="300px" height="250px">
															<span th:if="${activityVolunteer.endImage == null }">없음</span>
														</div>
													</div>
												</div>
											</div>
										</div>

									</div>
								</div>
							</div>
							<div id="editVolunteers" style="display: none;">
								<div class="multiselect">
									<div class="selectBox" onclick="showVolunteerCheckboxes()">
										<select style="width: 120px;padding: 0px">
											<option>봉사자를 선택하세요</option>
										</select>
										<div class="overSelect"></div>
									</div>
									<input id="searchVolunteers" type="text" placeholder="유저 이름으로 검색" style="height:99.5%; width: 200px; display: none;padding: 0px">
									<ul id="volunteers" style="list-style-type: none;">

									</ul>
								</div>
								<ul style="display:none;" id="clickedVolunteers" class="list-group mt-2">
								</ul>
							</div>

						</div>
					</div>
				</div>
			</div>

			<hr class="line">

			<div class="sub_contentbox">
				<div class="sub_heading" style="margin-right: 0px">활동 내용
					<button id="editActivityGroupBtn" class="edit">편집</button>
					<button id="cancelActivityGroupBtn" class="edit" style="display: none;">취소</button>
				</div>
				<div style="height:40px">
					<div class="inlinebox">
						<div class="menu_name">활동 시간</div>
					</div>
					<div class="inlinebox">
						<p id="volunteerTime" th:if="${activityDto.startTime==null} and ${activityDto.endTime==null}">시작 시간 없음 ~ 끝 시간 없음</p>
						<p id="volunteerTime" th:if="${activityDto.startTime} and ${activityDto.endTime==null}">[[${#temporals.format(activityDto.startTime, 'yyyy-MM-dd HH:mm')}]] ~ 끝 시간 없음</p>
						<p id="volunteerTime" th:if="${activityDto.startTime==null} and ${activityDto.endTime}">시작 시간 없음 ~ [[${#temporals.format(activityDto.endTime, 'yyyy-MM-dd HH:mm')}]]</p>
						<p id="volunteerTime" th:if="${activityDto.startTime} and ${activityDto.endTime}">[[${#temporals.format(activityDto.startTime, 'yyyy-MM-dd HH:mm')}]] ~ [[${#temporals.format(activityDto.endTime, 'yyyy-MM-dd HH:mm')}]]</p>

						<div id="editVolunteerTime" style="display: none;">
							<input type="date" id="startdate" name="startDate" th:value="${activityDto.startTime?.toLocalDate()}" style="width: 130px">
							<input type="time" id="starttime" name="startTime" th:value="${activityDto.startTime?.toLocalTime()}" style="width: 100px">
							<span id="sign">~</span>
							<input type="date" id="enddate" name="endDate" th:value="${activityDto.endTime?.toLocalDate()}" style="width: 130px">
							<input type="time" id="endtime" name="endTime" th:value="${activityDto.endTime?.toLocalTime()}" style="width: 100px">
						</div>
					</div>
				</div>
				<div class="user_left" style="margin-top: 30px">
<!--					<div class="explanationbox">-->
						<div class="inlinebox" style="float: left">
							<div class="menu_name explain">상세설명</div>
						</div>
						<div class="inlinebox explain_textarea" style="float: left;margin-top:5px">
							<p id="content" th:if="${activityDto.content.isEmpty()}">세부내용 없음</p>
							<p id="content" th:if="${activityDto.content != ''}" th:text="${activityDto.content}"></p>
							<input type="textarea" id="explianation" name="explanation" th:value="${activityDto.content}" style="display: none;">
						</div>
<!--					</div>-->
				</div>

				<div id="activity_map" class="user_right" style="top: 0px">
					<div class="search_box" style="margin-left: 0px">
						<div class="inlinebox">
							<div class="menu_name">장소</div>
						</div>
						<div class="inlinebox searchbox">
							<p id="place" th:if="${activityDto.place}" th:text="${activityDto.placeDetail != null} ? ${ activityDto.place + ' ' + activityDto.placeDetail} : ${activityDto.place}"></p>
							<div id="editPlace" name="place" style="display: none;">
								<input type="text" id="address" placeholder="주소" th:value="${activityDto.place}" style="margin-top: 50px;margin-bottom: 0px;height: 20px;" onclick="execPostcode()">
								<input type="text" id="simple_addr" placeholder="상세주소" th:value="${activityDto.placeDetail}" style="float:left;margin-top:10px;height: 20px;padding: 0 0 0 15px;width: 75%">
								<input type="hidden" id="coordi_x">
								<input type="hidden" id="coordi_y">
							</div>
						</div>
					</div>
					<div class="map" id="kakaomap" style="width:330px;height:300px;margin-left: 0px;margin-top: 17px"></div>
					<input type="hidden" id="original_place" th:value="${activityDto.place}">
				</div>
			</div>

			<hr id="lasthr" class="line">

			<div class="sub_contentbox deliveryGroup" style="margin-bottom:100px">
				<div class="sub_heading">나눔 내용</div>
				<div class="user_left">
					<div class="inlinebox">
						<div class="menu_name">전달 여부</div>
					</div>
					<div class="inlinebox">
						<span id="delivery" th:text="${activityDto.deliveryFlag == 1} ? '직접 수령' : '봉사자 통해 전달'" ></span>
						<div id="editDelivery" style="display: none;">
							<input type="radio" id="direct" name="delivery" value="1" th:checked="${activityDto.deliveryFlag} == 1">
							<label for="direct">직접 수령</label>
							<input type="radio" id="through" name="delivery" value="0" th:checked="${activityDto.deliveryFlag} == 0">
							<label for="through">봉사사 통해 전달</label>
						</div>
					</div>
				</div>
				<div id="product_picture" class="user_right" style="margin-top:15px">
					<div class="inlinebox" style="float:left">
						<div class="menu_name" style="margin-top:0px">물건 사진</div>
					</div>
					<div id="images" th:if="${files.size()} > 0" style="float:left">
						<img alt="image" th:each="file: ${files}" th:src="@{${'/images/' + file}}" width="250" height="250">
					</div>
				</div>
			</div>

			<hr class="divgap2">

		</div>
		<div id="buttonSet">
			<button id="submit" type="button" name="button" onclick="goList()"><img src="/img/29.png"></button>
		</div>
		</div>

	</div>

	<div lang="en" th:replace="common/footer :: footer"></div>
	<script>

		var origin_place = document.getElementById('original_place').value;

		var mapContainer = document.getElementById('kakaomap'), // 지도를 표시할 div
				mapOption = {
					center: new daum.maps.LatLng(37.537187, 127.005476), // 지도의 중심좌표
					level: 5 // 지도의 확대 레벨
				};

		//지도를 미리 생성
		var map = new daum.maps.Map(mapContainer, mapOption);
		//주소-좌표 변환 객체를 생성
		var geocoder = new daum.maps.services.Geocoder();
		//마커를 미리 생성
		var marker = new daum.maps.Marker({
			position: new daum.maps.LatLng(37.537187, 127.005476),
			map: map
		});

		findCoordi(origin_place);

		function changeMap(y, x) {
			// 해당 주소에 대한 좌표를 받아서
			var coords = new daum.maps.LatLng(y, x);
			// 지도를 보여준다.
			mapContainer.style.display = "block";
			map.relayout();
			// 지도 중심을 변경한다.
			map.setCenter(coords);
			// 마커를 결과값으로 받은 위치로 옮긴다.
			marker.setPosition(coords)
		}

		function findCoordi(addr) {

			console.log(addr);
			geocoder.addressSearch(addr, function(results, status) {
				// 정상적으로 검색이 완료됐으면
				if (status === daum.maps.services.Status.OK) {

					var result = results[0]; //첫번째 결과의 값을 활용
					document.getElementById("coordi_x").value = result.x;
					document.getElementById("coordi_y").value = result.y;

					// // 해당 주소에 대한 좌표를 받아서
					var coords = new daum.maps.LatLng(result.y, result.x);
					// 지도를 보여준다.
					mapContainer.style.display = "block";
					map.relayout();
					// 지도 중심을 변경한다.
					map.setCenter(coords);
					// 마커를 결과값으로 받은 위치로 옮긴다.
					marker.setPosition(coords)
				}
			});
		}

		function execPostcode() {
			new daum.Postcode({
				oncomplete: function(data) {
					var addr = data.address; // 최종 주소 변수

					// 주소 정보를 해당 필드에 넣는다.
					document.getElementById("address").value = addr;
					// 주소로 상세 정보를 검색
					geocoder.addressSearch(addr, function(results, status) {
						// 정상적으로 검색이 완료됐으면
						if (status === daum.maps.services.Status.OK) {

							var result = results[0]; //첫번째 결과의 값을 활용
							document.getElementById("coordi_x").value = result.x;
							document.getElementById("coordi_y").value = result.y;
							changeMap(result.y, result.x);
						}
					});
				}
			}).open();
		}

		function goList() {
			window.history.back();
		}


		function hideMessage() {
			$('#message').hide();
		}

		function changeStatus(event) {
			var newValue = event.target.id;

			$.post("/activitydata/setTitleAndStatus", {
				id: $('#activityId').val(),
				title: $('#editTitleField').val(),
				status: newValue
			}, function (data) {
				window.location.reload();
			});
		}

		var expandedUsers = false;
		var expandedVolunteers = false;

		function showUserCheckboxes() {
			var checkboxes = document.getElementById("users");
			var searchboxes = document.getElementById("searchUsers");
			if (!expandedUsers) {
				checkboxes.style.display = "block";
				searchboxes.style.display = "block";
				expandedUsers = true;
			} else {
				checkboxes.style.display = "none";
				searchboxes.style.display = "none";
				expandedUsers = false;
			}
		}

		function showVolunteerCheckboxes() {
			var checkboxes = document.getElementById("volunteers");
			var searchboxes = document.getElementById("searchVolunteers");
			if (!expandedVolunteers) {
				checkboxes.style.display = "block";
				searchboxes.style.display = "block";
				expandedVolunteers = true;
			} else {
				checkboxes.style.display = "none";
				searchboxes.style.display = "none";
				expandedVolunteers = false;
			}
		}


		var volunteerTime;

		function editVolunteerTime(volunteerId){

			volunteerTime = $('#editVolunteerTime' + volunteerId).val();

			if($('#editVolunteerTimeBtn' + volunteerId).html().toString().includes('편집')){
				$('#volunteerTime' + volunteerId).hide();
				$('#editVolunteerTime' + volunteerId).show();
				$('#cancelVolunteerTimeBtn' + volunteerId).show();
				$('#editVolunteerTimeBtn' + volunteerId).html('완료');
			} else{
				if($('#editVolunteerTime' + volunteerId).val().length == 0){

					$('#message').removeClass("alert-info");
					$('#message').addClass("alert-danger");
					$('#mContent').html("봉사시간은 1글자 이상이어야 합니다");
					$('#message').show();

					setTimeout(function() {
						hideMessage();
					}, 2000);

				}
				else{
					$.post("/activitydata/setVolunteerTime", {id: $('#activityId').val(), volunteerId: volunteerId, time: volunteerTime}, function(data) {

						$('#volunteerTime' + volunteerId).html(data);

						$('#editVolunteerTimeBtn' + volunteerId).html('편집');
						$('#volunteerTime' + volunteerId).show();
						$('#editVolunteerTime' + volunteerId).hide();
						$('#cancelVolunteerTimeBtn' + volunteerId).hide();

						$('#message').removeClass("alert-danger");
						$('#message').addClass("alert-info");
						$('#mContent').html("봉사시간을 수정하였습니다.");
						$('#message').show();

						setTimeout(function() {
							hideMessage();
						}, 2000);

					});
				}
			}
		}

		function cancelVolunteerTime(volunteerId){
			$('#volunteerTime' + volunteerId).toggle();
			$('#editVolunteerTime' + volunteerId).toggle();
			$('#editVolunteerTime' + volunteerId).val(volunteerTime);

			$('#cancelVolunteerTimeBtn' + volunteerId).toggle();
			$('#editVolunteerTimeBtn' + volunteerId).html('편집');
		}

		var statusValue;

		$('#editTitleGroupBtn').click(function() {

			$('#editTitleField').toggle();

			$('#titleText').toggle();

			statusValue = $('#editStatus').val();

			$('#editStatus').toggle();

			$('#status').toggle();

			$('#cancelTitleGroupBtn').toggle();

			if ($('#editTitleGroupBtn').html() == '편집') {
				$('#editTitleGroupBtn').html('완료');
			} else {
				if ($('#editTitleField').val().length == 0) {

					$('#editTitleField').toggle();

					$('#titleText').toggle();

					$('#editStatus').toggle();

					$('#status').toggle();

					$('#cancelTitleGroupBtn').toggle();

					$('#message').removeClass("alert-info");
					$('#message').addClass("alert-danger");
					$('#mContent').html("제목은 1글자 이상이어야 합니다");
					$('#message').show();

					setTimeout(function () {
						hideMessage();
					}, 2000);

				} else {
					$('#editTitleGroupBtn').html('편집');
					console.log(statusValue);
					$.post("/activitydata/setTitleAndStatus", {
						id: $('#activityId').val(),
						title: $('#editTitleField').val(),
						status: statusValue
					}, function (data) {
						var arr = data.split("|");
						$('#titleText').html(arr[0]);
						var status;
						switch (Number(arr[1])) {
							case 0:
								status = 0;
								$('#tag').attr("src","/img/before_matching.png");
								$('#editCategoryGroupBtn').show();
								$('#editUserGroupBtn').show();
								break;
							case 1:
								status = 1;
								$('#tag').attr("src","/img/ing_matching.png");
								$('#editCategoryGroupBtn').hide();
								$('#editUserGroupBtn').show();
								break;
							case 2:
								status = 2;
								$('#tag').attr("src","/img/done_matching.png");
								$('#editCategoryGroupBtn').hide();
								$('#editUserGroupBtn').hide();
								break;
							case 3:
								status = 3;
								$('#tag').attr("src","/img/ing_activity.png");
								$('#editCategoryGroupBtn').hide();
								$('#editUserGroupBtn').hide();
								break;
							case 4:
								status = 4;
								$('#tag').attr("src","/img/done_activity.png");
								$('#editCategoryGroupBtn').hide();
								$('#editUserGroupBtn').hide();

								$.post("/userdata/addtime", {
									id: id,
									time: document.getElementById("currentTime").value
								}, function (data) {
									console.log(data);
								});

								break;
							case 5:
								status = 5;
								$('#tag').attr("src","/img/cancle_activity.png");
								$('#editCategoryGroupBtn').hide();
								$('#editUserGroupBtn').hide();
						}
						$('#status').val(status);

						$('#message').removeClass("alert-danger");
						$('#message').addClass("alert-info");
						$('#mContent').html("제목과 상태를 수정하였습니다.");
						$('#message').show();

						setTimeout(function () {
							hideMessage();
						}, 2000);
						window.location.reload();
					});
				}

			}
		})

		$('#cancelTitleGroupBtn').click(function(){
			$('#editTitleField').toggle();
			$('#editTitleField').val($('#titleText').html());
			$('#titleText').toggle();
			$('#editStatus').toggle();
			$('#editStatus').val(statusValue);
			$('#status').toggle();

			$('#cancelTitleGroupBtn').toggle();
			$('#editTitleGroupBtn').html('편집');
		})


		var categoryValue;
		var deadlineDate;
		var deadlineTime;

		$('#editCategoryGroupBtn').click(function() {

			categoryValue = $('#editCategory').val();

			$('#editCategory').toggle();

			$('#category').toggle();

			deadlineDate = $('input[name="deadlineDate"]').val();
			deadlineTime = $('input[name="deadlineTime"]').val();

			$('#editDeadline').toggle();

			$('#deadline').toggle();

			$('#cancelCategoryGroupBtn').toggle();

			if($('#editCategoryGroupBtn').html() == '편집'){
				$('#editCategoryGroupBtn').html('완료');
			}
			else{

				if(categoryValue == 0 || deadlineDate == "" || deadlineTime == ""){
					$('#editCategory').toggle();

					$('#category').toggle();

					$('#editDeadline').toggle();

					$('#deadline').toggle();

					$('#cancelCategoryGroupBtn').toggle();

					$('#message').removeClass("alert-info");
					$('#message').addClass("alert-danger");
					if(categoryValue == 0){
						$('#mContent').html("지정한 카테고리는 없는 카테고리입니다");
					}
					else if(deadlineDate == ""){
						$('#mContent').html("마감 날짜가 입력되지 않았습니다");
					}
					else{
						$('#mContent').html("마감 시간이 입력되지 않았습니다");
					}
					$('#message').show();

					setTimeout(function() {
						hideMessage();
					}, 2000);
				}
				else{
					$('#editCategoryGroupBtn').html('편집');
					$.post("/activitydata/setCategoryAndDeadline",
							{ id: $('#activityId').val(),
								category: categoryValue,
								deadlineDate: deadlineDate,
								deadlineTime: deadlineTime
							},
							function(data) {
								var arr = data.split(".");
								$('#category').val(arr[0]);
								$('#deadline').text((arr[1] === "" || arr[2] === "")?"마감시간 없음":arr[1] + " " + arr[2]);

								$('#message').removeClass("alert-danger");
								$('#message').addClass("alert-info");
								$('#mContent').html("카테고리와 마감 기한을 수정하였습니다.");
								$('#message').show();

								setTimeout(function() {
									hideMessage();
								}, 2000);
							});
				}

			}
		})

		$('#cancelCategoryGroupBtn').click(function(){
			$('#editCategory').toggle();
			$('#editCategory').val(categoryValue);
			$('#category').toggle();

			getUsers(true, categoryValue);

			$('#editDeadline').toggle();
			var deadlineText = $('#deadline').text();

			if(deadlineText.includes("마감시간 없음")){
				$('input[name="deadlineDate"]').val("");
				$('input[name="deadlineTime"]').val("");
			}
			else{
				$('input[name="deadlineDate"]').val(deadlineDate);
				$('input[name="deadlineTime"]').val(deadlineTime);
			}
			$('#deadline').toggle();

			$('#cancelCategoryGroupBtn').toggle();
			$('#editCategoryGroupBtn').html('편집');
		})


		const usersPerPage = 4;
		var numOfPages = 0;
		var numOfPagesVolunteers = 0;
		var users = [];
		var volunteers = [];
		var clickedUsers = [];
		var clickedVolunteers = [];
		var userList = [];
		var volunteerList = [];
		var userStatusList = [];

		$('.userIds').each(function(){
			clickedUsers.push($(this).val());
			userList.push($(this).val());
		});

		$('.volunteerIds').each(function(){
			clickedVolunteers.push($(this).val());
			volunteerList.push($(this).val());
		});

		function fancyClickUsers(){
			try{
				var innerHtml = (clickedUsers.length>0)?"이용자:":"";
				if(userStatusList.length > 0){
					userStatusList.forEach(function(user){
						if(clickedUsers.indexOf(user.id.toString()) > -1){
							innerHtml += " <li class='list-group-item list-group-item-success'>"+ user.name + "<br>" + user.phone +"</li>";
						}
					});
				}

			}
			finally{
				$('#clickedUsers').html(innerHtml);
			}
		}

		function fancyClickVolunteers(){
			try{
				var innerHtml = (clickedVolunteers.length>0)?"봉사자:":"";
				var color="";
				var status;
				if(userStatusList.length > 0){
					userStatusList.forEach(function(user){
						if(clickedVolunteers.indexOf(user.id.toString()) > -1){
							if(typeof $('#volunteer'+ user.id).val() === 'undefined'){
								status = user.status;
							}
							else{
								status = $('#volunteer'+ user.id).val();
							}
							if(status == 0){
								color = "warning";
							}
							else if(status == 1){
								color = "success";
							}
							else{
								color = "danger";
							}
							innerHtml += " <li class='list-group-item list-group-item-" + color + "'>"+ user.name + "<br>" + user.phone +"</li>";
						}
					});
				}

			}
			finally{
				$('#clickedVolunteers').html(innerHtml);
			}
		}

		function addEventListenersToUsers(){
			$('input[name="userId"]').each(function(){

				/*if($(this).prop('checked')){
                    $('#editVolunteers li input[value="'+ $(this).val() +'"]').prop('disabled', true);
                }*/

				if(clickedUsers.indexOf($(this).val()) > -1){
					$(this).prop('checked', true);
					//$('#user'+ $(this).val()).toggle();
				}

				$(this).click(function(){
					$('#volunteers li input[value="'+ $(this).val() +'"]').prop('disabled', function(i, v) { return !v; });
					$('#user'+ $(this).val()).toggle();

					if($(this).prop('checked')){
						if(clickedUsers.indexOf($(this).val()) == -1){
							clickedUsers.push($(this).val());
						}
					}
					else{
						if(clickedUsers.indexOf($(this).val()) > -1){
							clickedUsers.splice(clickedUsers.indexOf($(this).val()), 1);
						}
					}

					fancyClickUsers();

				})

			})

			/*$('input[name="userId"]+label+select').each(function(){
                $(this).change(function(){

                    for(var i = 0; i < users.length ; i++){
                        if(users[i].id == $(this).attr('id').replace("user","")){
                            users[i].status = $(this).val();
                            break;
                        }
                    }

                });
            })*/;
		}

		function addEventListenersToVolunteers(){

			$('input[name="volunteerId"]').each(function(){

				/*if($(this).prop('checked')){
                    $('#editUsers li input[value="'+ $(this).val() +'"]').prop('disabled', true);
                }*/

				if(clickedVolunteers.indexOf($(this).val()) > -1){
					$(this).prop('checked', true);
					$('#volunteer'+ $(this).val()).toggle();
				}

				$(this).click(function(){
					$('#users li input[value="'+ $(this).val() +'"]').prop('disabled', function(i, v) { return !v; });
					$('#volunteer'+ $(this).val()).toggle();

					if($(this).prop('checked')){
						if(clickedVolunteers.indexOf($(this).val()) == -1){
							clickedVolunteers.push($(this).val());
						}
					}
					else{
						if(clickedVolunteers.indexOf($(this).val()) > -1){
							clickedVolunteers.splice(clickedVolunteers.indexOf($(this).val()), 1);
						}
					}

					fancyClickVolunteers();

				})

			})

			$('input[name="volunteerId"]+label+select').each(function(){
				$(this).change(function(){

					for(var i = 0; i < volunteers.length ; i++){
						if(volunteers[i].id == $(this).attr('id').replace("volunteer","")){
							volunteers[i].status = $(this).val();
							break;
						}
					}

					fancyClickVolunteers();
				});
			});

		}


		function searchUsers(keyword){
			var innerHtml = "";
			var innerPage = "";
			users = [];
			searchUsersKeyword = keyword;

			try{

				userStatusList.forEach(function(user){
					if(user.type == null || user.type == 0){
						users.push(user);
					}
				});

				if(users.length > 0){
					var count = 0;
					users.forEach(function(item){
						if(item.name.includes(keyword)){
							innerHtml += "<li><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='userId'";
						}
						else{
							innerHtml += "<li style='display: none;'><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='userId'";
						}

						if(clickedVolunteers.indexOf(item.id.toString()) > -1){
							innerHtml += " disabled> <label style='pointer-events: none' for='"+ item.id +"'>"+ item.name +"</label></li>";
						}
						else{
							innerHtml += "> <label style='pointer-events: none' for='"+ item.id +"'>"+ item.name +"</label></li>";
						}


						/*if(item.status==null || item.status == 0){
                            innerHtml += "<select style='display: none;' id='user"+ item.id +"'><option value='0' selected>대기</option><option value='1'>승인</option><option value='2'>거절</option></select></li>";
                        }
                        else if(item.status == 1){
                            innerHtml += "<select style='display: none;' id='user"+ item.id +"'><option value='0'>대기</option><option value='1' selected>승인</option><option value='2'>거절</option></select></li>";
                        }
                        else{
                            innerHtml += "<select style='display: none;' id='user"+ item.id +"'><option value='0'>대기</option><option value='1'>승인</option><option value='2' selected>거절</option></select></li>";
                        }*/


					})


				}
				else{
					innerHtml = "해당 이용자가 없습니다.";
				}

			}
			finally{

				$('#users').html(innerHtml);

				addEventListenersToUsers();

			}

		}

		function searchVolunteers(keyword){
			var innerHtml = "";
			var innerPage = "";
			volunteers = [];
			searchVolunteersKeyword = keyword;

			try{

				userStatusList.forEach(function(user){
					if((user.type == null || user.type == 1)){
						volunteers.push(user);
					}
				});

				if(volunteers.length > 0){

					var count = 0;
					volunteers.forEach(function(item){
						if(item.name.includes(keyword)){
							innerHtml += "<li><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='volunteerId'";
						}
						else{
							innerHtml += "<li style='display: none;'><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='volunteerId'";
						}

						if(clickedUsers.indexOf(item.id.toString()) > -1){
							innerHtml += " disabled> <label style='pointer-events: none' for='"+ item.id +"'>"+ item.name +"</label>";
						}
						else{
							innerHtml += "> <label style='pointer-events: none' for='"+ item.id +"'>"+ item.name +"</label>";
						}

						if(item.status==null || item.status == 0){
							innerHtml += "<select style='display: none;' id='volunteer"+ item.id +"'><option value='0' selected>대기</option><option value='1'>승인</option><option value='2'>거절</option></select></li>";
						}
						else if(item.status == 1){
							innerHtml += "<select style='display: none;' id='volunteer"+ item.id +"'><option value='0'>대기</option><option value='1' selected>승인</option><option value='2'>거절</option></select></li>";
						}
						else{
							innerHtml += "<select style='display: none;' id='volunteer"+ item.id +"'><option value='0'>대기</option><option value='1'>승인</option><option value='2' selected>거절</option></select></li>";
						}

					})

				}
				else{
					innerHtml = "해당 이용자가 없습니다.";
				}

			}
			finally{

				$('#volunteers').html(innerHtml);

				addEventListenersToVolunteers();

			}

		}

		function getUsers(isSearch, category){
			$.get("/activitydata/getUsers", {id: $('#activityId').val(), category: category}, function(data) {

				userStatusList = data;

				if(isSearch){
					searchUsers("");
					searchVolunteers("");

					fancyClickUsers();
					fancyClickVolunteers();

					var userIdList = [];

					try{

						if(userStatusList!=null && userStatusList.length > 0){
							userStatusList.forEach(function(user){
								userIdList.push(user.id.toString());
							});
						}

					}
					finally{

						for(var i = clickedUsers.length -1; i >= 0 ; i--){
							if(userIdList.indexOf(clickedUsers[i]) == -1){
								clickedUsers.splice(i, 1);
							}
						}

						for(var i = clickedVolunteers.length -1; i >= 0 ; i--){
							if(userIdList.indexOf(clickedVolunteers[i]) == -1){
								clickedVolunteers.splice(i, 1);
							}
						}

					}
				}

			});
		}

		getUsers(false, $('#editCategory').val());
		$(".unauthenticated").hide();

		$('#editCategory').on('change', function() {

			getUsers(true, $('#editCategory').val());

		});

		if($('#editCategory option:selected').html().toString().includes("물건")){
			$('.deliveryGroup').show();
			$('#lasthr').show();
		}
		else{
			$('.deliveryGroup').hide();
			$('#lasthr').hide();
		}


		$('input#searchUsers').on('input', function() {searchUsers($('#searchUsers').val())});

		$('input#searchVolunteers').on('input', function() {searchVolunteers($('#searchVolunteers').val())});

		$('#editUserGroupBtn').click(function() {

			//var userStatusList = [];
			var volunteerStatusList = [];

			/*if(clickedUsers!=null && clickedUsers.length > 0){
                clickedUsers.forEach(function(userId){
                    userStatusList.push($('#user' + userId).val());
                });
            }*/

			if(clickedVolunteers!=null && clickedVolunteers.length > 0){
				clickedVolunteers.forEach(function(volunteerId){
					volunteerStatusList.push($('#volunteer' + volunteerId).val());
				});
			}

			$('#editUsers').toggle();

			$('#userList').toggle();

			$('#clickedUsers').toggle();

			searchUsers("");

			$('#editVolunteers').toggle();

			$('#volunteerList').toggle();

			$('#clickedVolunteers').toggle();

			searchVolunteers("");

			fancyClickUsers();
			fancyClickVolunteers();

			managerValue = $('#editManager').val();

			$('#editManager').toggle();

			$('#manager').toggle();

			$('#cancelUserGroupBtn').toggle();

			if($('#editManager').css("display")=="none") {
				$('#admin_background').addClass('charge');
			} else {
				$('#admin_background').removeClass('charge');
			}

			if($('#editUserGroupBtn').html() == '편집'){
				$('#editUserGroupBtn').html('완료');
			}
			else{

				$('#editUserGroupBtn').html('편집');
				$.post("/activitydata/setPeople", {id: $('#activityId').val(), users: clickedUsers, /*userStatusList: userStatusList,*/ volunteers: clickedVolunteers, volunteerStatusList: volunteerStatusList, manager: managerValue}, function(data) {
					var innerUsersHtml = "";
					var innerVolunteersHtml = "";
					try{
						if(data.users.length > 0){
							$('#userList').removeClass("members user");
							data.users.forEach(function(item){
								innerUsersHtml += "<div class='members user'><input type='hidden' class='userIds' value='"+ item.user.id +"'/><a data-fancybox data-src='#userDetail" + item.user.id +"' href='javascript:;'>"+ item.user.name +"</a><span>"+ item.user.phone +"</span><div style='display: none;' id='userDetail" + item.user.id +"'><img src='/img/v_bar.png'><h3 style='padding-left: 20px'>이용자 정보</h3><div style='padding-left: 20px'><div class='sub_heading'>기본 정보</div><div><div class='user_left' style='width: 100%'><div class='inlinebox'><div class='v_menuname' style='float: left;'>이름</div><input type='text' class='v_menuval' id='v_name' name='v_name' value='"+ item.user.name +"' disabled></div><br><div class='inlinebox'><div class='v_menuname' style='float: left;'>전화번호</div><input type='text' class='v_menuval' id='v_phone' name='v_phone' value='"+ item.user.phone +"' disabled></div><br><div class='inlinebox'><div class='v_menuname' style='float: left;'>이메일</div><input type='text' class='v_menuval' id='v_phone' name='v_email' value='"+ item.user.socialId +"' style='width: 200px' disabled></div><br><div class='inlinebox'><div class='v_menuname' style='float: left;'>관심사</div>";

								item.userInterestList.forEach(function(interest){
									innerUsersHtml += "<span><input type='checkbox' id='interest" + interest.id +"' name='userInterestList' value='"+ interest.name +"' hidden/><div id='"+ interest.id +"' class='button'><span>"+ interest.name +"</span><img src='/img/deactive.png'></div></span>";
								});

								innerUsersHtml += "</div></div></div></div></div></div>";
							})
						}
						else{
							$('#userList').addClass("members user");
							innerUsersHtml = "이용자 없음";
						}

						if(data.volunteers.length > 0){
							$('#volunteerList').removeClass("members worker");
							data.volunteers.forEach(function(item){
								innerVolunteersHtml += "<div class='members worker'><input type='hidden' class='volunteerIds' value='"+ item.user.id +"'/><div><a data-fancybox data-src='#volunteerDetail" + item.user.id +"' href='javascript:;'>"+ item.user.name +"</a><span>"+ item.user.phone +"</span><div style='display: none;' id='volunteerDetail" + item.user.id +"'><img src='/img/v_bar.png'><h3 style='padding-left: 20px'>봉사자 정보</h3><div style='padding-left: 20px'><div class='sub_heading'>기본 정보</div><div><div class='user_left'><div class='inlinebox'><div class='v_menuname' style='float: left;'>이름</div><input type='text' class='v_menuval' id='v_name' name='v_name' value='"+ item.user.name +"' disabled></div><br><div class='inlinebox'><div class='v_menuname' style='float: left;'>전화번호</div><input type='text' class='v_menuval' id='v_phone' name='v_phone' value='"+ item.user.phone +"' disabled></div><br>";

								var status = "<div class='inlinebox'><div class='v_menuname' style='float: left;'>상태</div>";

								switch(item.status){
									case 0: status +="<input type='text' class='v_menuval' id='v_status0' name='v_status' value='대기' disabled>";
										break;
									case 1: status +="<input type='text' class='v_menuval' id='v_status1' name='v_status' value='승인' disabled>";
										break;
									case 2: status +="<input type='text' class='v_menuval' id='v_status2' name='v_status' value='거절' disabled>";
								}

								status += "</div></div>";

								var phoneAgree = "<div class='user_right'><div class='inlinebox'><div class='v_menuname' style='float: left;'>전화번호 공유 동의</div><div style='float:left;margin-top: 10px'>"

								phoneAgree += (item.phoneAgree==1)?"<img style='width: 15px' src='/img/v_ok.png'/>":"<img style='width: 15px' src='/img/v_nok.png'/>";
								phoneAgree += "</div></div><br>";

								var locationAgree = "<div class='inlinebox'><div class='v_menuname' style='float: left;'>위치 공유 동의</div><div style='float:left;margin-top: 10px'>";

								locationAgree += (item.locationAgree==1)?"<img style='width: 15px' src='/img/v_ok.png'/>":"<img style='width: 15px' src='/img/v_nok.png'/>";
								locationAgree += "</div></div><br>";

								var volunteerTime = "<div class='inlinebox'><div class='v_menuname' style='float: left;'>봉사 시간</div><div style='float: left;margin-top: 10px'><span id='volunteerTime"+ item.user.id +"'>"+ item.volunteerTime +"</span>시간<input id='editVolunteerTime"+ item.user.id +"' type='text' style='display:none;width: 75px' value='"+ item.volunteerTime +"'><button id='editVolunteerTimeBtn"+ item.user.id +"' onclick='editVolunteerTime("+ item.user.id +");'>편집</button><button id='cancelVolunteerTimeBtn"+ item.volunteerTime +"' onclick='cancelVolunteerTime("+ item.user.id +");' style='display: none;'>취소</button></div></div></div></div></div>";


								var startImage = "<hr class='line'><div style='padding-left: 20px'><div class='sub_heading'>활동 사진</div><div><div class='user_left'><div class='v_menuname'>시작 사진</div><div>";

								if(item.startImage != null){
									startImage += "<img style='display:block; width: 300px' alt='image' src='"+ item.startImage +"' width='300px' height='250px'>";
								} else{
									startImage += "<span>없음</span>"
								}

								startImage += "</div></div>";

								var endImage = "<div class='user_right'><div class='v_menuname'>끝 사진</div><div>";

								if(item.endImage != null){
									endImage += "<img style='display:block; width: 300px' alt='image' src='"+ item.endImage +"' width='300px' height='250px'>";
								}
								else{
									endImage += "<span>없음</span>"
								}

								endImage += "</div></div></div></div></div></div></div>";

								innerVolunteersHtml += status + phoneAgree + locationAgree + volunteerTime + startImage + endImage;

							})
						}
						else{
							$('#volunteerList').addClass("members worker");
							innerVolunteersHtml = "봉사자 없음";
						}
					}
					finally{
						$('#userList').html(innerUsersHtml);
						userList = clickedUsers;
						$('#volunteerList').html(innerVolunteersHtml);
						volunteerList = clickedVolunteers;
						$('#manager').text(data.managerName);
						getUsers(false, $('#editCategory').val());

						$('#message').removeClass("alert-danger");
						$('#message').addClass("alert-info");
						$('#mContent').html("담당 인원을 수정하였습니다.");
						$('#message').show();

						setTimeout(function() {
							hideMessage();
						}, 2000);
					}
				});
			}
		})

		$('#cancelUserGroupBtn').click(function(){

			$('#editUsers').toggle();

			$('#admin_background').addClass('charge');

			if(userList.length != 0){
				userList.forEach(function(item){
					$('#users li input[value="'+ item +'"]').prop('checked', true);
					$('#volunteers li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#users li input').each(function(){
					if($(this).prop('checked')){
						$(this).prop('checked', false);
						$('#volunteers li input[value="'+ $(this).val() +'"]').prop('disabled', false);
					}
				})
			}
			$('#userList').toggle();
			$('#clickedUsers').toggle();
			$('#users').html("");
			$('#searchUsers').val("");
			$('#pagingUsers').html("");
			clickedUsers = userList;

			$('#editVolunteers').toggle();
			if(volunteerList.length != 0){
				volunteerList.forEach(function(item){
					$('#volunteers li input[value="'+ item +'"]').prop('checked', true);
					$('#users li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#volunteers li input').each(function(){
					if($(this).prop('checked')){
						$(this).prop('checked', false);
						$('#users li input[value="'+ $(this).val() +'"]').prop('disabled', false);
					}
				})
			}
			$('#volunteerList').toggle();
			$('#clickedVolunteers').toggle();
			$('#volunteers').html("");
			$('#searchVolunteers').val("");
			$('#pagingVolunteers').html("");
			clickedVolunteers = volunteerList;

			$('#editManager').toggle();
			$('#editManager').val(managerValue);
			$('#manager').toggle();

			$('#cancelUserGroupBtn').toggle();
			$('#editUserGroupBtn').html('편집');
		})

		$('cancelSearchUsersBtn').click(function(){
			if(userList.length != 0){
				userList.forEach(function(item){
					$('#users li input[value="'+ item +'"]').prop('checked', true);
					$('#volunteers li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#users li input').each(function(){
					if($(this).prop('checked')){
						$(this).prop('checked', false);
						$('#volunteers li input[value="'+ $(this).val() +'"]').prop('disabled', false);
					}
				})
			}

			$('#users').html("");
			$('#searchUsers').val("");
			$('#pagingUsers').html("");
			clickedUsers = userList;
			fancyClickUsers();
		});

		$('#cancelSearchVolunteersBtn').click(function(){
			if(volunteerList.length != 0){
				volunteerList.forEach(function(item){
					$('#volunteers li input[value="'+ item +'"]').prop('checked', true);
					$('#users li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#volunteers li input').each(function(){
					if($(this).prop('checked')){
						$(this).prop('checked', false);
						$('#users li input[value="'+ $(this).val() +'"]').prop('disabled', false);
					}
				})
			}

			$('#volunteers').html("");
			$('#searchVolunteers').val("");
			$('#pagingVolunteers').html("");
			clickedVolunteers = volunteerList;
			fancyClickVolunteers();
		});


		var startDate;
		var startTime;
		var endDate;
		var endTime;

		$('#editActivityGroupBtn').click(function() {

			startDate = $('input[name="startDate"]').val();
			startTime = $('input[name="startTime"]').val();
			endDate = $('input[name="endDate"]').val();
			endTime = $('input[name="endTime"]').val();

			$('#editVolunteerTime').toggle();

			$('#volunteerTime').toggle();

			$('#editPlace').toggle();

			$('#place').toggle();

			$('#explianation').toggle();

			$('#content').toggle();

			$('#cancelActivityGroupBtn').toggle();

			if($('#editActivityGroupBtn').html() == '편집'){
				$('#editActivityGroupBtn').html('완료');
			}
			else{
				if(startDate == "" || startTime == "" || endDate == "" || endTime == "" || $('#address').val().length == 0){

					$('#editVolunteerTime').toggle();

					$('#volunteerTime').toggle();

					$('#editPlace').toggle();

					$('#place').toggle();

					$('#explianation').toggle();

					$('#content').toggle();

					$('#cancelActivityGroupBtn').toggle();

					$('#message').removeClass("alert-info");
					$('#message').addClass("alert-danger");

					if(startDate == ""){
						$('#mContent').html("시작 날짜가 입력되지 않았습니다");
					}
					else if(startTime == ""){
						$('#mContent').html("시작 시간이 입력되지 않았습니다");
					}
					else if(endDate == ""){
						$('#mContent').html("끝 날짜가 입력되지 않았습니다");
					}
					else if(endTime == ""){
						$('#mContent').html("끝 시간이 입력되지 않았습니다");
					}
					else{
						$('#mContent').html("장소가 입력되지 않았습니다");
					}
					$('#message').show();

					setTimeout(function() {
						hideMessage();
					}, 2000);
				}
				else{
					$('#editActivityGroupBtn').html('편집');
					$.post("/activitydata/setVolunteerTimeAndPlaceAndContent",
							{ id: $('#activityId').val(),
								startDate: startDate,
								startTime: startTime,
								endDate: endDate,
								endTime: endTime,
								place: $('#address').val(),
								placeDetail: $('#simple_addr').val(),
								content: $('#explianation').val()
							},
							function(data) {
								var arr = data.split("|");
								if(arr[0] !== ""){
									$('#place').html(arr[0]);
								}
								else{
									$('#place').text("장소 없음");
								}
								if(arr[1] !== ""){
									$('#content').text(arr[1]);
								}
								else{
									$('#content').text("세부내용 없음");
								}

								var start = (arr[2] === "" || arr[3] === "")?"시작 시간 없음":arr[2] + " " + arr[3];
								var end = (arr[4] === "" || arr[5] === "")?"끝 시간 없음":arr[4] + " " + arr[5];
								$('#volunteerTime').text(start + " ~ " + end);

								$('#message').removeClass("alert-danger");
								$('#message').addClass("alert-info");
								$('#mContent').html("활동 내용을 수정하였습니다.");
								$('#message').show();

								setTimeout(function() {
									hideMessage();
								}, 2000);
							});
					var y = document.getElementById("coordi_y").value;
					var x = document.getElementById("coordi_x").value;
					changeMap(y, x);
				}

			}
		})

		$('#cancelActivityGroupBtn').click(function(){
			$('#editVolunteerTime').toggle();
			var volunteerTimeText = $('#volunteerTime').text();

			if(volunteerTimeText.includes("시작 시간 없음") && volunteerTimeText.includes("끝 시간 없음")){
				$('input[name="startDate"]').val("");
				$('input[name="startTime"]').val("");
				$('input[name="endDate"]').val("");
				$('input[name="endTime"]').val("");
			}
			else if(volunteerTimeText.includes("시작 시간 없음")){
				$('input[name="startDate"]').val("");
				$('input[name="startTime"]').val("");
				$('input[name="endDate"]').val(endDate);
				$('input[name="endTime"]').val(endTime);
			}
			else if(volunteerTimeText.includes("끝 시간 없음")){
				$('input[name="startDate"]').val(startDate);
				$('input[name="startTime"]').val(startTime);
				$('input[name="endDate"]').val("");
				$('input[name="endTime"]').val("");
			}
			else{
				$('input[name="startDate"]').val(startDate);
				$('input[name="startTime"]').val(startTime);
				$('input[name="endDate"]').val(endDate);
				$('input[name="endTime"]').val(endTime);
			}

			$('#volunteerTime').toggle();

			$('#editPlace').toggle();
			var placeText = $('#place').text();
			if(placeText == "장소 없음"){
				$('#address').val("");
			}
			else{
				$('#address').val($('#place').text());
			}
			$('#place').toggle();

			$('#explianation').toggle();
			var contentText = $('#content').text();
			if(contentText == "세부내용 없음"){
				$('#explianation').val("");
			}
			else{
				$('#explianation').val($('#content').text());
			}
			$('#content').toggle();

			findCoordi(origin_place);

			$('#cancelActivityGroupBtn').toggle();
			$('#editActivityGroupBtn').html('편집');

		})

	</script>
</body>
</html>