<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<head lang="en" th:replace="common/header :: header"></head>
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f0794c5090c6554a68e453d22b1837f5&libraries=services"></script>
<body>

	<div lang="en" th:replace="common/menu :: menu"></div>

	<div id="main" style="margin-left: 15%">

	<button id="openNav" style="display: none"
			class="w3-button w3-teal w3-xlarge" onclick="w3_open()">&#9776;</button>
	<div class="w3-container">
		<h4>활동 상세 페이지</h4>
	</div>

	<div class="container">
		<input type="hidden" id="activityId" th:value="${activityDto.id}" />

		<div class="row">
			<div class="col-md-3">
					<h4 id="titleText" th:text="${activityDto.title}" style="display: inline"></h4>
					<input id="editTitleField" type="text" th:value="${activityDto.title}"
						   style="display: none;">
<!--					<button id="editTitleButton">수정</button>-->
<!--					<button id="cancelTitleButton" style="display: none;">취소</button>-->
			</div>
			<div class="col-md-7">
					<p id="status" th:switch="${activityDto.status}" style="display:inline;">
						<span th:case="'0'">매칭 전</span> <span th:case="'1'">진행중</span> <span
							th:case="'2'">매칭 완료</span> <span th:case="'3'">모집 마감</span>
					</p>
					<select id="editStatus" style="display: none;">
						<option th:value="0" th:selected="${activityDto.status} == 0">매칭 전</option>
						<option th:value="1" th:selected="${activityDto.status} == 1">진행중</option>
						<option th:value="2" th:selected="${activityDto.status} == 2">매칭 완료</option>
						<option th:value="3" th:selected="${activityDto.status} == 3">모집 마감</option>
					</select>
<!--					<button id="editStatusButton">수정</button>-->
<!--					<button id="cancelStatusButton" style="display: none;">취소</button>-->
			</div>
			<div class="col-md-2">
				<a href="#" id="editTitleGroupBtn">편집</a>
				<a href="#" id="cancelTitleGroupBtn" style="display: none;">취소</a>
			</div>
		</div>
		<hr>
		<div class="row">
			<div class="col-md-5">
				<label for="category">카테고리</label>

				<p id="category" th:if="${activityDto.interestCategory}"
				   th:text="${activityDto.interestCategory.name}" style="display: inline"></p>
				<p id="category" th:if="${activityDto.interestCategory==null}" style="display: inline">카테고리 없음</p>

				<select id="editCategory" style="display: none;">
					<option value="0">관심사를 선택하세요</option>
					<option th:each="interest : ${interests}" th:value="${interest.id}"
						th:text="${interest.name}"
						th:selected="${interest.id} == ${activityDto.interestCategory?.id}"></option>
				</select>
<!--				<button id="editCategoryButton">수정</button>-->
<!--				<button id="cancelCategoryButton" style="display: none;">취소</button>-->
			</div>
			<div class="col-md-5">
				<label for="deadline">마감 기한</label>
				<p id="deadline" th:if="${activityDto.deadline==null}" style="display: inline">마감시간 없음</p>
				<p id="deadline" th:if="${activityDto.deadline}" style="display: inline">[[${#temporals.format(activityDto.deadline, 'yyyy-MM-dd HH:mm')}]]</p>
				<div id="editDeadline" style="display: none;">
					<input type="date" name="deadlineDate" th:value="${activityDto.deadline?.toLocalDate()}">
					<input type="time" name="deadlineTime" th:value="${activityDto.deadline?.toLocalTime()}">
				</div>
<!--				<button id="editDeadlineButton">수정</button>-->
<!--				<button id="cancelDeadlineButton" style="display: none;">취소</button>-->
			</div>
			<div class="col-md-2">
				<a href="#" id="editCategoryGroupBtn">편집</a>
				<a href="#" id="cancelCategoryGroupBtn" style="display: none;">취소</a>
			</div>
		</div>
		<hr>
		<div class="row">
			<h4>담당 인원</h4>
		</div>
		<div class="row">
			<div class="col-md-4">
				<div class="row">
					<label for="userList">이용자</label>
					<p id="userList" th:if="${activityDto.activityUsers.size()} == 0" style="display:inline;">이용자 없음</p>
					<table id="userList" th:if="${activityDto.activityUsers.size()} > 0">
						<tr th:each="activityUser : ${activityDto.activityUsers}">
							<td class="userIds" style="display:none;" th:text="${activityUser.user?.id}"></td>
							<td>
								<a th:text="${activityUser.user?.name}" data-fancybox th:data-src="${'#userDetail' + activityUser.user?.id}" href="javascript:;"></a>
								<div style="display: none;" th:id="${'userDetail' + activityUser.user?.id}">
									<p th:text="${activityUser.phoneAgree == 0} ? 'X' : 'O'"></p>
									<p th:text="${activityUser.locationAgree == 0} ? 'X' : 'O'"></p>
									<p th:switch="${activityUser.status}"><span th:case="'0'">대기</span> <span th:case="'1'">승인</span> <span th:case="'2'">거절</span></p>
									<img th:if="${activityUser.startImage}" alt="image" th:src="@{${'/images/' + activityUser.startImage}}">
									<img th:if="${activityUser.endImage}" alt="image" th:src="@{${'/images/' + activityUser.endImage}}">
								</div>
							</td>
							<td th:text="${activityUser.user?.phone}"></td>
<!--								<td class="text-center" th:text="${activityUser.phoneAgree == 0} ? 'X' : 'O'"></td>-->
<!--								<td class="text-center" th:text="${activityUser.locationAgree == 0} ? 'X' : 'O'"></td>-->
<!--								<td th:switch="${activityUser.status}"><span th:case="'0'">대기</span> <span th:case="'1'">승인</span> <span-->
<!--										th:case="'2'">거절</span></td>-->
						</tr>
					</table>
					<div id="editUsers" style="display: none;">
						<input id="searchUsers" type="text" placeholder="유저 이름으로 검색">
						<ul id="users">

						</ul>
						<div id="pagingUsers">

						</div>
						<!--  <li th:each="user : ${users}"><input type="checkbox"
									th:id="${user.id}" th:value="${user.id}" name="userId"
									th:checked="${activityDto.userIds.contains(user.id)}"
									autocomplete="off" /> <label th:for="${user.id}"
									th:text="${user.name}"></label></li> -->
					</div>
<!--					<button id="editUsersButton">수정</button>-->
<!--					<button id="cancelUsersButton" style="display: none;">취소</button>-->
				</div>
				<div class="row">
					<label for="manager">관리자</label>
					<p id="manager" th:if="${activityDto.manager==null}" style="display: inline">관리자 없음</p>
					<p id="manager" th:if="${activityDto.manager}" th:text="${activityDto.manager.name}"></p>
					<select id="editManager" style="display: none;">
						<option value="0">관리자를 선택하세요</option>
						<option th:each="manager : ${managers}" th:value="${manager.id}" th:text="${manager.name}" th:selected="${manager.id} == ${activityDto.manager?.id}"></option>
					</select>
<!--					<button id="editManagerButton">수정</button>-->
<!--					<button id="cancelManagerButton" style="display: none;">취소</button>-->
				</div>
			</div>
			<div class="col-md-6">
				<label for="volunteerList">봉사자</label>
				<p id="volunteerList" th:if="${activityDto.activityVolunteers.size()} == 0" style="display: inline">봉사자 없음</p>
				<table id="volunteerList" th:if="${activityDto.activityVolunteers.size()} > 0">
					<tr th:each="activityVolunteer : ${activityDto.activityVolunteers}">
						<td class="volunteerIds" style="display:none;" th:text="${activityVolunteer.user?.id}"></td>
						<td>
							<a th:text="${activityVolunteer.user?.name}" data-fancybox th:data-src="${'#volunteerDetail' + activityVolunteer.user?.id}" href="javascript:;"></a>
							<div style="display: none;" th:id="${'volunteerDetail' + activityVolunteer.user?.id}">
								<p th:text="${activityVolunteer.phoneAgree == 0} ? 'X' : 'O'"></p>
								<p th:text="${activityVolunteer.locationAgree == 0} ? 'X' : 'O'"></p>
								<p th:switch="${activityVolunteer.status}"><span th:case="'0'">대기</span> <span th:case="'1'">승인</span> <span th:case="'2'">거절</span></p>
								<img th:if="${activityVolunteer.startImage}" alt="image" th:src="@{${'/images/' + activityVolunteer.startImage}}">
								<img th:if="${activityVolunteer.endImage}" alt="image" th:src="@{${'/images/' + activityVolunteer.endImage}}">
							</div>
						</td>
						<td th:text="${activityVolunteer.user?.phone}"></td>
<!--							<td class="text-center" th:text="${activityVolunteer.phoneAgree == 0} ? 'X' : 'O'"></td>-->
<!--							<td class="text-center" th:text="${activityVolunteer.locationAgree == 0} ? 'X' : 'O'"></td>-->
<!--							<td th:switch="${activityVolunteer.status}"><span th:case="'0'">대기</span> <span th:case="'1'">승인</span> <span-->
<!--									th:case="'2'">거절</span></td>-->
					</tr>
				</table>
				<div id="editVolunteers" style="display: none;">
					<input id="searchVolunteers" type="text" placeholder="유저 이름으로 검색">
					<ul id="volunteers">

					</ul>
					<div id="pagingVolunteers">

					</div>
					<!--  <li th:each="volunteer : ${users}"><input type="checkbox"
							  th:id="${volunteer.id}" th:value="${volunteer.id}"
							  name="volunteerId"
							  th:checked="${activityDto.volunteerIds.contains(volunteer.id)}" /> <label
							  th:for="${volunteer.id}" th:text="${volunteer.name}"></label></li> -->
				</div>
<!--				<button id="editVolunteersButton">수정</button>-->
<!--				<button id="cancelVolunteersButton" style="display: none;">취소</button>-->
			</div>
			<div class="col-md-2">
				<a  href="#" id="editUserGroupBtn">편집</a>
				<a  href="#" id="cancelUserGroupBtn" style="display: none;">취소</a>
			</div>
		</div>
		<hr>
		<div class="row">
			<h4>활동 내용</h4>
		</div>
		<div class="row">
			<div class="col-md-6">
				<div class="row">
					<label for="volunteerTime">활동 시간</label>
					<p id="volunteerTime" th:if="${activityDto.startTime==null} and ${activityDto.endTime==null}">시작 시간 없음 ~ 끝 시간 없음</p>
					<p id="volunteerTime" th:if="${activityDto.startTime} and ${activityDto.endTime==null}">[[${#temporals.format(activityDto.startTime, 'yyyy-MM-dd HH:mm')}]] ~ 끝 시간 없음</p>
					<p id="volunteerTime" th:if="${activityDto.startTime==null} and ${activityDto.endTime}">시작 시간 없음 ~ [[${#temporals.format(activityDto.endTime, 'yyyy-MM-dd HH:mm')}]]</p>
					<p id="volunteerTime" th:if="${activityDto.startTime} and ${activityDto.endTime}">[[${#temporals.format(activityDto.startTime, 'yyyy-MM-dd HH:mm')}]] ~ [[${#temporals.format(activityDto.endTime, 'yyyy-MM-dd HH:mm')}]]</p>
					<div id="editVolunteerTime" style="display: none;">
						시작 시간: <input type="date" name="startDate" th:value="${activityDto.startTime?.toLocalDate()}">
						<input type="time" name="startTime" th:value="${activityDto.startTime?.toLocalTime()}"> <br>
						끝 시간: <input type="date" name="endDate" th:value="${activityDto.endTime?.toLocalDate()}">
						<input type="time" name="endTime" th:value="${activityDto.endTime?.toLocalTime()}">
					</div>
<!--					<button id="editVolunteerTimeButton">수정</button>-->
<!--					<button id="cancelVolunteerTimeButton" style="display: none;">취소</button>-->
				</div>
				<div class="row">
					<label for="content">세부내용</label>
					<p id="content" th:if="${activityDto.content.isEmpty()}">세부내용 없음</p>
					<p id="content" th:if="${activityDto.content != ''}" th:text="${activityDto.content}"></p>
					<textarea id="editContent" name="content" style="display: none;">[[${activityDto.content}]]</textarea>
<!--					<button id="editContentButton">수정</button>-->
<!--					<button id="cancelContentButton" style="display: none;">취소</button>-->
				</div>
			</div>
			<div class="col-md-4">
				<div class="row">
					<label for="place">장소</label>
					<p id="place" th:if="${activityDto.place.isEmpty()}">장소 없음</p>
					<p id="place" th:if="${activityDto.place}" th:text="${activityDto.place}"></p>

					<div id="editPlace" name="place" style="display: none;">
						<input type="text" id="address" placeholder="주소" th:value="${activityDto.place}">
						<input type="button" onclick="execPostcode()" value="주소 검색"><br>
						<input type="hidden" id="coordi_x">
						<input type="hidden" id="coordi_y">
					</div>
					<!--  <button id="editPlaceButton">수정</button>
					<button id="cancelPlaceButton" style="display: none;">취소</button> -->
				</div>
				<div class="row">
					<div id="kakaomap" style="width:300px;height:300px;margin-top:10px;"></div>
					<input type="hidden" id="original_place" th:value="${activityDto.place}">
				</div>
			</div>
			<div class="col-md-2">
				<a href="#" id="editActivityGroupBtn">편집</a>
				<a href="#" id="cancelActivityGroupBtn" style="display: none;">취소</a>
			</div>
		</div>
<!--				<div class="lead">-->
<!--					전달 여부:-->
<!--					<p id="delivery"-->
<!--					   th:text="${activityDto.deliveryFlag == 0} ? '직접 수령' : '봉사자 통해 전달'" />-->
<!--					<div id="editDelivery" style="display: none;">-->
<!--						<input type="radio" id="direct" name="delivery" value="0"-->
<!--							   th:checked="${activityDto.deliveryFlag} == 0"> <label-->
<!--							for="direct">직접 수령</label> <input type="radio" id="through"-->
<!--															  name="delivery" value="1"-->
<!--															  th:checked="${activityDto.deliveryFlag} == 1"> <label-->
<!--							for="through">봉사사 통해 전달</label>-->
<!--					</div>-->
<!--					<button id="editDeliveryButton">수정</button>-->
<!--					<button id="cancelDeliveryButton" style="display: none;">취소</button>-->
<!--				</div>-->

<!--				<div class="lead" id="images" th:if="${files.size()} > 0">-->
<!--					<img alt="image" th:each="file: ${files}" th:src="@{${'/images/' + file}}" width="250" height="250">-->
<!--				</div>-->
	</div>

	<div>
		<a th:href="@{/activity}">
			<button>목록</button>
		</a>
	</div>
		 
		 <!--  전화번호 공유 동의:
		<p id="phoneAgree" th:text="${activityDto.phoneAgree == 0} ? 'X' : 'O'" />
		<div id="editPhoneAgree" style="display: none;">
			<input type="checkbox" id="phoneAgree" name="phoneAgree"
				th:checked="${activityDto.phoneAgree} == 1" /> <label
				for="phoneAgree">전화번호 공유 동의</label>
		</div>
		<button id="editPhoneAgreeButton">수정</button>
		<button id="cancelPhoneAgreeButton" style="display: none;">취소</button>
		<br>
		<br> 
		 <a th:href="@{'/activity/activityForm/edit/' + ${activityDto.id}}">
			<button>수정</button>
		</a> -->

		<script th:inline="javascript">

			var origin_place = document.getElementById('original_place').value;

			var mapContainer = document.getElementById('kakaomap'), // 지도를 표시할 div
					mapOption = {
						center: new daum.maps.LatLng(37.537187, 127.005476), // 지도의 중심좌표
						level: 5 // 지도의 확대 레벨
					};

			//지도를 미리 생성
			var map = new daum.maps.Map(mapContainer, mapOption);
			//주소-좌표 변환 객체를 생성
			var geocoder = new daum.maps.services.Geocoder();
			//마커를 미리 생성
			var marker = new daum.maps.Marker({
				position: new daum.maps.LatLng(37.537187, 127.005476),
				map: map
			});

			findCoordi(origin_place);

			function changeMap(y, x) {
				// 해당 주소에 대한 좌표를 받아서
				var coords = new daum.maps.LatLng(y, x);
				// 지도를 보여준다.
				mapContainer.style.display = "block";
				map.relayout();
				// 지도 중심을 변경한다.
				map.setCenter(coords);
				// 마커를 결과값으로 받은 위치로 옮긴다.
				marker.setPosition(coords)
			}

			function findCoordi(addr) {

				console.log(addr);
				geocoder.addressSearch(addr, function(results, status) {
					// 정상적으로 검색이 완료됐으면
					if (status === daum.maps.services.Status.OK) {

						var result = results[0]; //첫번째 결과의 값을 활용
						document.getElementById("coordi_x").value = result.x;
						document.getElementById("coordi_y").value = result.y;

						// // 해당 주소에 대한 좌표를 받아서
						var coords = new daum.maps.LatLng(result.y, result.x);
						// 지도를 보여준다.
						mapContainer.style.display = "block";
						map.relayout();
						// 지도 중심을 변경한다.
						map.setCenter(coords);
						// 마커를 결과값으로 받은 위치로 옮긴다.
						marker.setPosition(coords)
					}
				});
			}

			function execPostcode() {
				new daum.Postcode({
					oncomplete: function(data) {
						var addr = data.address; // 최종 주소 변수

						// 주소 정보를 해당 필드에 넣는다.
						document.getElementById("address").value = addr;
						// 주소로 상세 정보를 검색
						geocoder.addressSearch(addr, function(results, status) {
							// 정상적으로 검색이 완료됐으면
							if (status === daum.maps.services.Status.OK) {

								var result = results[0]; //첫번째 결과의 값을 활용
								document.getElementById("coordi_x").value = result.x;
								document.getElementById("coordi_y").value = result.y;
							}
						});
					}
				}).open();
			}


			/*$('#editTitleButton').click(function() {
    		
    		$('#editTitleField').toggle();
    		
    		$('#titleText').toggle();
    		
    		$('#cancelTitleButton').toggle();
    		
    		if($('#editTitleButton').html() == '수정'){
    			$('#editTitleButton').html('완료');
    		}
    		else{
    			$('#editTitleButton').html('수정');
    			$.post("/activitydata/setTitle", {id: $('#activityId').val(), title: $('#editTitleField').val()}, function(data) {
    				$('#titleText').html(data);
            	});	
    		}
    	}) 
    	
    	$('#cancelTitleButton').click(function(){
			$('#editTitleField').toggle();
			$('#editTitleField').val($('#titleText').html());
    		$('#titleText').toggle();
    		$('#cancelTitleButton').toggle();
    		$('#editTitleButton').html('수정');
    	})*/
    	
		var statusValue;
    	
    	$('#editTitleGroupBtn').click(function() {
    		
    		$('#editTitleField').toggle();
    		
    		$('#titleText').toggle();
			
    		statusValue = $('#editStatus').val();
    		
    		$('#editStatus').toggle();
    		
    		$('#status').toggle();
    		
    		$('#cancelTitleGroupBtn').toggle();
    		
    		if($('#editTitleGroupBtn').html() == '편집'){
    			$('#editTitleGroupBtn').html('완료');
    		}
    		else{
    			$('#editTitleGroupBtn').html('편집');
    			$.post("/activitydata/setTitleAndStatus", {id: $('#activityId').val(), title: $('#editTitleField').val(), status: statusValue}, function(data) {
    				var arr = data.split("|");
    				$('#titleText').html(arr[0]);
    				var status;
    				switch(Number(arr[1])){
    					case 0: status = "매칭 전";
    					break;
    					case 1: status = "진행중";
    					break;
    					case 2: status = "매칭 완료";
    					break;
    					case 3: status = "모집 마감";
    				}
    				$('#status').html(status);
            	});	
    		}
    	})
    	
    	$('#cancelTitleGroupBtn').click(function(){
			$('#editTitleField').toggle();
			$('#editTitleField').val($('#titleText').html());
    		$('#titleText').toggle();
    		$('#editStatus').toggle();
			$('#editStatus').val(statusValue);
    		$('#status').toggle();
    		
    		$('#cancelTitleGroupBtn').toggle();
    		$('#editTitleGroupBtn').html('편집');
    	})
    	
    	/*var categoryValue;
    	
    	$('#editCategoryButton').click(function() {
    		
    		categoryValue = $('#editCategory').val();
    		
    		$('#editCategory').toggle();
    		
    		$('#category').toggle();
    		
    		$('#cancelCategoryButton').toggle();
    		
    		if($('#editCategoryButton').html() == '수정'){
    			$('#editCategoryButton').html('완료');
    		}
    		else{
    			$('#editCategoryButton').html('수정');
    			$.post("/activitydata/setCategory", {id: $('#activityId').val(), category: categoryValue}, function(data) {
    					$('#category').html(data);
            	});	
    		}
    	}) 
    	
    	$('#cancelCategoryButton').click(function(){
			$('#editCategory').toggle();
			$('#editCategory').val(categoryValue);
    		$('#category').toggle();
    		$('#cancelCategoryButton').toggle();
    		$('#editCategoryButton').html('수정');
    	})*/
    	
    	var categoryValue;
    	var deadlineDate;
    	var deadlineTime;
    	
    	$('#editCategoryGroupBtn').click(function() {
    		
			categoryValue = $('#editCategory').val();
    		
    		$('#editCategory').toggle();
    		
    		$('#category').toggle();
    		
    		deadlineDate = $('input[name="deadlineDate"]').val(); 
			deadlineTime = $('input[name="deadlineTime"]').val();
    		
    		$('#editDeadline').toggle();
    		
    		$('#deadline').toggle();
    		
    		$('#cancelCategoryGroupBtn').toggle();
    		
    		if($('#editCategoryGroupBtn').html() == '편집'){
    			$('#editCategoryGroupBtn').html('완료');
    		}
    		else{
    			$('#editCategoryGroupBtn').html('편집');
    			$.post("/activitydata/setCategoryAndDeadline", 
    				{ id: $('#activityId').val(), 
    				  category: categoryValue,
    				  deadlineDate: deadlineDate, 
    				  deadlineTime: deadlineTime
    				}, 
    				function(data) {
    					var arr = data.split(".");
    					$('#category').html(arr[0]);
    					$('#deadline').text((arr[1] === "" || arr[2] === "")?"마감시간 없음":arr[1] + " " + arr[2]);
            	});	
    		}
    	})
    	
    	$('#cancelCategoryGroupBtn').click(function(){
    		$('#editCategory').toggle();
			$('#editCategory').val(categoryValue);
    		$('#category').toggle();
    		
			$('#editDeadline').toggle();
			var deadlineText = $('#deadline').text();
			
			if(deadlineText.includes("마감시간 없음")){
				$('input[name="deadlineDate"]').val("");
				$('input[name="deadlineTime"]').val("");
			}
			else{
				$('input[name="deadlineDate"]').val(deadlineDate);
				$('input[name="deadlineTime"]').val(deadlineTime);
			}
			$('#deadline').toggle();
    		
    		$('#cancelCategoryGroupBtn').toggle();
    		$('#editCategoryGroupBtn').html('편집');
    	})
    	
    	/*var statusValue;
    	
    	$('#editStatusButton').click(function() {
    		
    		statusValue = $('#editStatus').val();
    		
    		$('#editStatus').toggle();
    		
    		$('#status').toggle();
    		
    		$('#cancelStatusButton').toggle();
    		
    		if($('#editStatusButton').html() == '수정'){
    			$('#editStatusButton').html('완료');
    		}
    		else{
    			$('#editStatusButton').html('수정');
    			$.post("/activitydata/setStatus", {id: $('#activityId').val(), status: statusValue}, function(data) {
    				var status;
    				switch(data){
    					case 0: status = "매칭 전";
    					break;
    					case 1: status = "진행중";
    					break;
    					case 2: status = "매칭 완료";
    					break;
    					case 3: status = "모집 마감";
    				}
    				$('#status').html(status);
            	});	
    		}
    	})
    	
    	$('#cancelStatusButton').click(function(){
			$('#editStatus').toggle();
			$('#editStatus').val(statusValue);
    		$('#status').toggle();
    		$('#cancelStatusButton').toggle();
    		$('#editStatusButton').html('수정');
    	})*/
    	
    	const usersPerPage = 4;
		var numOfPages = 0;
		var numOfPagesVolunteers = 0;
		var users = [];
		var volunteers = [];
		var clickedUsers = [];
		var clickedVolunteers = [];
		var userList = [];
		var volunteerList = [];
		var userStatusList = [];
		
		$('.userIds').each(function(){
			clickedUsers.push($(this).text());
			userList.push($(this).text());
		});
		
		$('.volunteerIds').each(function(){
			clickedVolunteers.push($(this).text());
			volunteerList.push($(this).text());
		});
	
		function addEventListenersToUsers(){
			$('input[name="userId"]').each(function(){
				
				/*if($(this).prop('checked')){
	    			$('#editVolunteers li input[value="'+ $(this).val() +'"]').prop('disabled', true);
				}*/
				
				if(clickedUsers.indexOf($(this).val()) > -1){
					$(this).prop('checked', true);
					$('#user'+ $(this).val()).toggle();
    			}
				
				$(this).click(function(){
					$('#volunteers li input[value="'+ $(this).val() +'"]').prop('disabled', function(i, v) { return !v; });
					$('#user'+ $(this).val()).toggle();
					
					if($(this).prop('checked')){
		    			if(clickedUsers.indexOf($(this).val()) == -1){
		    				clickedUsers.push($(this).val());
		    			}
					}
					else{
						if(clickedUsers.indexOf($(this).val()) > -1){
		    				clickedUsers.splice(clickedUsers.indexOf($(this).val()), 1);
		    			}
					}
					
				})
				
			})
			
			$('input[name="userId"]+label+select').each(function(){
				$(this).change(function(){
					
					for(var i = 0; i < users.length ; i++){
						if(users[i].id == $(this).attr('id').replace("user","")){
							users[i].status = $(this).val();
							break;
						}
					}
					
				});
			});
		}
		
		function addEventListenersToVolunteers(){
			
			$('input[name="volunteerId"]').each(function(){
				
				/*if($(this).prop('checked')){
	    			$('#editUsers li input[value="'+ $(this).val() +'"]').prop('disabled', true);
	    		}*/
				
				if(clickedVolunteers.indexOf($(this).val()) > -1){
					$(this).prop('checked', true);
					$('#volunteer'+ $(this).val()).toggle();
    			}
				
				$(this).click(function(){
					$('#users li input[value="'+ $(this).val() +'"]').prop('disabled', function(i, v) { return !v; });
					$('#volunteer'+ $(this).val()).toggle();
					
					if($(this).prop('checked')){
		    			if(clickedVolunteers.indexOf($(this).val()) == -1){
		    				clickedVolunteers.push($(this).val());
		    			}
					}
					else{
						if(clickedVolunteers.indexOf($(this).val()) > -1){
		    				clickedVolunteers.splice(clickedVolunteers.indexOf($(this).val()), 1);
		    			}
					}
					
				})
				
			})
			
			$('input[name="volunteerId"]+label+select').each(function(){
				$(this).change(function(){
					
					for(var i = 0; i < volunteers.length ; i++){
						if(volunteers[i].id == $(this).attr('id').replace("volunteer","")){
							volunteers[i].status = $(this).val();
							break;
						}
					}
					
				});
			});
			
		}
		
		function addEventListenersToUserPagingButtons(){
			$('#pagingUsers button.page').each(function(){
				
				$(this).click(function(){
					var pageNumber = $(this).text();
					var innerHtml = "";
					try{
						
						for(var i = 0; i < users.length ; i++ ){
							
							if(i >= ((pageNumber-1)*usersPerPage) && i < (pageNumber*usersPerPage)){
								innerHtml += "<li><input type='checkbox' id='"+ users[i].id + "' value='"+ users[i].id +"' name='userId'";										
							}
							else{
								innerHtml += "<li style='display: none;'><input type='checkbox' id='"+ users[i].id + "' value='"+ users[i].id +"' name='userId'";	
							}
							
							if(clickedVolunteers.indexOf(users[i].id.toString()) > -1){
								innerHtml += " disabled> <label for='"+ users[i].id +"'>"+ users[i].name +"</label>";
							}
							else{
								innerHtml += "> <label for='"+ users[i].id +"'>"+ users[i].name +"</label>";
							}
							
							if(users[i].status==null || users[i].status == 0){
								innerHtml += "<select style='display: none;' id='user"+ users[i].id +"'><option value='0' selected>대기</option><option value='1'>승인</option><option value='2'>거절</option></select></li>";
							}
							else if(users[i].status == 1){
								innerHtml += "<select style='display: none;' id='user"+ users[i].id +"'><option value='0'>대기</option><option value='1' selected>승인</option><option value='2'>거절</option></select></li>";
							}
							else{
								innerHtml += "<select style='display: none;' id='user"+ users[i].id +"'><option value='0'>대기</option><option value='1'>승인</option><option value='2' selected>거절</option></select></li>";
							}
							
						}
						
					}
					finally{
						$('#users').html(innerHtml);
						addEventListenersToUsers();
					}
				})
				
			})
			
		}
		
		function addEventListenersToVolunteerPagingButtons(){
			$('#pagingVolunteers button.page').each(function(){
				
				$(this).click(function(){
					var pageNumber = $(this).text();
					var innerHtml = "";
					try{
						
						for(var i = 0; i < volunteers.length ; i++ ){
							
							if(i >= ((pageNumber-1)*usersPerPage) && i < (pageNumber*usersPerPage)){
								innerHtml += "<li><input type='checkbox' id='"+ volunteers[i].id + "' value='"+ volunteers[i].id +"' name='volunteerId'";										
							}
							else{
								innerHtml += "<li style='display: none;'><input type='checkbox' id='"+ volunteers[i].id + "' value='"+ volunteers[i].id +"' name='volunteerId'";	
							}
							
							if(clickedUsers.indexOf(volunteers[i].id.toString()) > -1){
								innerHtml += " disabled> <label for='"+ volunteers[i].id +"'>"+ volunteers[i].name +"</label>";
							}
							else{
								innerHtml += "> <label for='"+ volunteers[i].id +"'>"+ volunteers[i].name +"</label>";
							}
							
							if(volunteers[i].status==null || volunteers[i].status == 0){
								innerHtml += "<select style='display: none;' id='volunteer"+ volunteers[i].id +"'><option value='0' selected>대기</option><option value='1'>승인</option><option value='2'>거절</option></select></li>";
							}
							else if(volunteers[i].status == 1){
								innerHtml += "<select style='display: none;' id='volunteer"+ volunteers[i].id +"'><option value='0'>대기</option><option value='1' selected>승인</option><option value='2'>거절</option></select></li>";
							}
							else{
								innerHtml += "<select style='display: none;' id='volunteer"+ volunteers[i].id +"'><option value='0'>대기</option><option value='1'>승인</option><option value='2' selected>거절</option></select></li>";
							}
							
						}
						
					}
					finally{
						$('#volunteers').html(innerHtml);
						addEventListenersToVolunteers();
					}
				})
				
			})
			
		}
		
		function searchUsers(keyword){
			var innerHtml = "";
			var innerPage = "";
			var pages = 0;
			users = [];
			
			try{
				
				userStatusList.forEach(function(user){
					if(user.name.includes(keyword) && (user.type == null || user.type == 0)){
						users.push(user);
					}
				});
				
				if(users.length > 0){
					var count = 0;
					users.forEach(function(item){
						if(pages<1){
							innerHtml += "<li><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='userId'";									
						}
						else{
							innerHtml += "<li style='display: none;'><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='userId'";							
						}
						
						if(clickedVolunteers.indexOf(item.id.toString()) > -1){
							innerHtml += " disabled> <label for='"+ item.id +"'>"+ item.name +"</label>";
						}
						else{
							innerHtml += "> <label for='"+ item.id +"'>"+ item.name +"</label>";
						}

						
						if(item.status==null || item.status == 0){
							innerHtml += "<select style='display: none;' id='user"+ item.id +"'><option value='0' selected>대기</option><option value='1'>승인</option><option value='2'>거절</option></select></li>";
						}
						else if(item.status == 1){
							innerHtml += "<select style='display: none;' id='user"+ item.id +"'><option value='0'>대기</option><option value='1' selected>승인</option><option value='2'>거절</option></select></li>";
						}
						else{
							innerHtml += "<select style='display: none;' id='user"+ item.id +"'><option value='0'>대기</option><option value='1'>승인</option><option value='2' selected>거절</option></select></li>";
						}
						
						count++;
						
						if(count == usersPerPage){
							pages++;
							count = 0;
						}
					})
					
					numOfPages = (count>0)?pages+1:pages;
					
					for(var i = 0; i < numOfPages ; i++){
						innerPage += "<button type='button' class='page'>"+ (i+1) +"</button>";
					}
				}
				else{
					innerHtml = "그 이름의 이용자를 찾지 못했습니다";	
				}
				
			}
			finally{
				
				$('#users').html(innerHtml);
				$('#pagingUsers').html(innerPage);
				
				addEventListenersToUsers();
				addEventListenersToUserPagingButtons();
				
			}	
		
		}
		
		function searchVolunteers(keyword){
			var innerHtml = "";
			var innerPage = "";
			var pages = 0;
			volunteers = [];
			
			try{
				
				userStatusList.forEach(function(user){
					if(user.name.includes(keyword) && (user.type == null || user.type == 1)){
						volunteers.push(user);
					}
				});
				
				if(volunteers.length > 0){
					
					var count = 0;
					volunteers.forEach(function(item){
						if(pages<1){
							innerHtml += "<li><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='volunteerId'";									
						}
						else{
							innerHtml += "<li style='display: none;'><input type='checkbox' id='"+ item.id + "' value='"+ item.id +"' name='volunteerId'";							
						}
						
						if(clickedUsers.indexOf(item.id.toString()) > -1){
							innerHtml += " disabled> <label for='"+ item.id +"'>"+ item.name +"</label>";
						}
						else{
							innerHtml += "> <label for='"+ item.id +"'>"+ item.name +"</label>";
						}
						
						if(item.status==null || item.status == 0){
							innerHtml += "<select style='display: none;' id='volunteer"+ item.id +"'><option value='0' selected>대기</option><option value='1'>승인</option><option value='2'>거절</option></select></li>";
						}
						else if(item.status == 1){
							innerHtml += "<select style='display: none;' id='volunteer"+ item.id +"'><option value='0'>대기</option><option value='1' selected>승인</option><option value='2'>거절</option></select></li>";
						}
						else{
							innerHtml += "<select style='display: none;' id='volunteer"+ item.id +"'><option value='0'>대기</option><option value='1'>승인</option><option value='2' selected>거절</option></select></li>";
						}
						
						count++;
						
						if(count == usersPerPage){
							pages++;
							count = 0;
						}
					})
					
					numOfPagesVolunteers = (count>0)?pages+1:pages;
					
					for(var i = 0; i < numOfPagesVolunteers ; i++){
						innerPage += "<button type='button' class='page'>"+ (i+1) +"</button>";
					}
					
				}
				else{
					innerHtml = "그 이름의 이용자를 찾지 못했습니다";
				}
				
			}
			finally{
				
				$('#volunteers').html(innerHtml);
				$('#pagingVolunteers').html(innerPage);
				
				addEventListenersToVolunteers();
				addEventListenersToVolunteerPagingButtons();
				
			}
			
		}
		
		$.get("/activitydata/getUsers", {id: $('#activityId').val()}, function(data) {
			
			userStatusList = data;
			
		});
		
		
		$('input#searchUsers').on('input', function() {searchUsers($('#searchUsers').val())});
		
		$('input#searchVolunteers').on('input', function() {searchVolunteers($('#searchVolunteers').val())});
    	
    	/*$('#editUsersButton').click(function() {
    		
    		$('#editUsers').toggle();
    		
    		$('#userList').toggle();
    		
    		$('#cancelUsersButton').toggle();
    		
    		if($('#editUsersButton').html() == '수정'){
    			$('#editUsersButton').html('완료');
    		}
    		else{
    			$('#editUsersButton').html('수정');
    			
    			$.post("/activitydata/setUsers", {id: $('#activityId').val(), users: clickedUsers}, function(data) {
    				var innerHtml = "";
    				try{
    					if(data.length > 0){
    						innerHtml = "<tr><th>이름</th><th>전화번호</th><th>전화번호 공유 동의</th><th>위치 공유 동의</th><th>상태</th></tr>";
    						data.forEach(function(item){
    							var phoneAgree = (item.phoneAgree==0)?"X":"O";
    							var locationAgree = (item.locationAgree==0)?"X":"O";
    							var status = "";
    							switch(item.status){
    								case 0: status ="대기";
    								break;
    								case 1: status ="승인";
    								break;
    								case 2: status ="거절";
    							}
        						innerHtml += "<tr><td>" + item.user.name + "</td><td>" + item.user.phone + "</td><td class='text-center'>" + phoneAgree + "</td><td class='text-center'>" + locationAgree + "</td><td>" + status +  "</td></tr>";
        					})
    					}
    					else{
    						innerHtml = "이용자 없음";
    					}
    				}
    				finally{
    					$('#userList').html(innerHtml);	
    					userList = clickedUsers;
    				}
    				
            	});
    		}
    	})
    	
    	$('#cancelUsersButton').click(function(){
			$('#editUsers').toggle();
			if(userList.length != 0){
				userList.forEach(function(item){
					$('#editUsers ul li input[value="'+ item +'"]').prop('checked', true);
					$('#editVolunteers ul li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#editUsers ul li input').each(function(){
	    			if($(this).prop('checked')){
	    				$(this).prop('checked', false);
						$('#editVolunteers ul li input[value="'+ $(this).val() +'"]').prop('disabled', false);
	    			}
	    		})
			}
    		$('#userList').toggle();
    		$('#cancelUsersButton').toggle();
    		$('#editUsersButton').html('수정');
    		$('#users').html("");
    		$('#searchUsers').val("");
    		$('#pagingUsers').html("");
    		clickedUsers = userList;
    	})
    	
    	$('#editVolunteersButton').click(function() {
    		
    		$('#editVolunteers').toggle();
    		
    		$('#volunteerList').toggle();
    		
    		$('#cancelVolunteersButton').toggle();
    		
    		if($('#editVolunteersButton').html() == '수정'){
    			$('#editVolunteersButton').html('완료');
    		}
    		else{
    			$('#editVolunteersButton').html('수정');
    			$.post("/activitydata/setVolunteers", {id: $('#activityId').val(), volunteers: clickedVolunteers}, function(data) {
    				var innerHtml = "";
    				try{
    					if(data.length > 0){
    						innerHtml = "<tr><th>이름</th><th>전화번호</th><th>전화번호 공유 동의</th><th>위치 공유 동의</th><th>상태</th></tr>";
    						data.forEach(function(item){
    							var phoneAgree = (item.phoneAgree==0)?"X":"O";
    							var locationAgree = (item.locationAgree==0)?"X":"O";
    							var status = "";
    							switch(item.status){
    								case 0: status ="대기";
    								break;
    								case 1: status ="승인";
    								break;
    								case 2: status ="거절";
    							}
    							innerHtml += "<tr><td>" + item.user.name + "</td><td>" + item.user.phone + "</td><td class='text-center'>" + phoneAgree + "</td><td class='text-center'>" + locationAgree + "</td><td>" + status +  "</td></tr>";
        					})
    					}
    					else{
    						innerHtml = "봉사자 없음";
    					}
    				}
    				finally{
    					$('#volunteerList').html(innerHtml);
    					volunteerList = clickedVolunteers;
    				}
    				
            	});
    		}
    	})
    	
    	$('#cancelVolunteersButton').click(function(){
			$('#editVolunteers').toggle();
			if(volunteerList.length != 0){
				volunteerList.forEach(function(item){
					$('#editVolunteers ul li input[value="'+ item +'"]').prop('checked', true);
					$('#editUsers ul li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#editVolunteers ul li input').each(function(){
	    			if($(this).prop('checked')){
	    				$(this).prop('checked', false);
						$('#editUsers ul li input[value="'+ $(this).val() +'"]').prop('disabled', false);
	    			}
	    		})
			}
			
    		$('#volunteerList').toggle();
    		$('#cancelVolunteersButton').toggle();
    		$('#editVolunteersButton').html('수정');
    		$('#volunteers').html("");
    		$('#searchVolunteers').val("");
    		$('#pagingVolunteers').html("");
    		clickedVolunteers = volunteerList;
    	})
    	
    	var managerValue;
    	
    	$('#editManagerButton').click(function() {
    		
    		managerValue = $('#editManager').val();
    		
    		$('#editManager').toggle();
    		
    		$('#manager').toggle();
    		
    		$('#cancelManagerButton').toggle();
    		
    		if($('#editManagerButton').html() == '수정'){
    			$('#editManagerButton').html('완료');
    		}
    		else{
    			$('#editManagerButton').html('수정');
    			$.post("/activitydata/setManager", {id: $('#activityId').val(), manager: managerValue}, function(data) {
    				$('#manager').text(data);
            	});	
    		}
    	})
    	
    	$('#cancelManagerButton').click(function(){
			$('#editManager').toggle();
			$('#editManager').val(managerValue);
    		$('#manager').toggle();
    		$('#cancelManagerButton').toggle();
    		$('#editManagerButton').html('수정');
    	})
    	
    	*/
    	
		$('#editUserGroupBtn').click(function() {
			
    		var userStatusList = [];
    		var volunteerStatusList = [];
    		
			if(clickedUsers!=null && clickedUsers.length > 0){
				clickedUsers.forEach(function(userId){
    				userStatusList.push($('#user' + userId).val());
    			});
			}
			
			if(clickedVolunteers!=null && clickedVolunteers.length > 0){
				clickedVolunteers.forEach(function(volunteerId){
    				volunteerStatusList.push($('#volunteer' + volunteerId).val());
    			});
			}
    		
			$('#editUsers').toggle();
    		
    		$('#userList').toggle();
    		
    		searchUsers("");
    		
			$('#editVolunteers').toggle();
    		
    		$('#volunteerList').toggle();
    		
    		searchVolunteers("");
    		
    		managerValue = $('#editManager').val();
    		
    		$('#editManager').toggle();
    		
    		$('#manager').toggle();
    		
    		$('#cancelUserGroupBtn').toggle();
    		
    		if($('#editUserGroupBtn').html() == '편집'){
    			$('#editUserGroupBtn').html('완료');
    		}
    		else{
    			
    			$('#editUserGroupBtn').html('편집');
    			$.post("/activitydata/setPeople", {id: $('#activityId').val(), users: clickedUsers, userStatusList: userStatusList, volunteers: clickedVolunteers, volunteerStatusList: volunteerStatusList, manager: managerValue}, function(data) {
    				var innerUsersHtml = "";
    				var innerVolunteersHtml = "";
    				try{
    					if(data.users.length > 0){
    						data.users.forEach(function(item){
								innerUsersHtml += "<tr><td><a data-fancybox data-src='#userDetail" + item.user.id +"' href='javascript:;'>"+ item.user.name +"</a><div style='display: none;' id='userDetail" + item.user.id +"'>";
    							
    							var phoneAgree = (item.phoneAgree==0)?"X":"O";
    							var locationAgree = (item.locationAgree==0)?"X":"O";
    							var status = "";
    							var startImage = "";
    							var endImage = "";
    							switch(item.status){
    								case 0: status ="대기";
    								break;
    								case 1: status ="승인";
    								break;
    								case 2: status ="거절";
    							}
    							if(item.startImage != null){
    								startImage = "<img alt='image' src='/images/"+ item.startImage +"'>";
    							}
    							if(item.endImage != null){
    								endImage = "<img alt='image' src='/images/"+ item.endImage +"'>";
    							}
    							
								innerUsersHtml += "<p>"+ phoneAgree +"</p><p>"+ locationAgree +"</p><p><span>"+ status +"</span></p>" + startImage + endImage + "</div></td><td>" + item.user.phone + "</td></tr>";
        					})
    					}
    					else{
    						innerUsersHtml = "이용자 없음";
    					}
    					
    					if(data.volunteers.length > 0){
    						data.volunteers.forEach(function(item){
    							innerVolunteersHtml += "<tr><td><a data-fancybox data-src='#volunteerDetail" + item.user.id +"' href='javascript:;'>"+ item.user.name +"</a><div style='display: none;' id='volunteerDetail" + item.user.id +"'>";
    							
    							var phoneAgree = (item.phoneAgree==0)?"X":"O";
    							var locationAgree = (item.locationAgree==0)?"X":"O";
    							var status = "";
    							var startImage = "";
    							var endImage = "";
    							switch(item.status){
    								case 0: status ="대기";
    								break;
    								case 1: status ="승인";
    								break;
    								case 2: status ="거절";
    							}
    							if(item.startImage != null){
    								startImage = "<img alt='image' src='/images/"+ item.startImage +"'>";
    							}
    							if(item.endImage != null){
    								endImage = "<img alt='image' src='/images/"+ item.endImage +"'>";
    							}
    							
								innerVolunteersHtml += "<p>"+ phoneAgree +"</p><p>"+ locationAgree +"</p><p><span>"+ status +"</span></p>" + startImage + endImage + "</div></td><td>" + item.user.phone + "</td></tr>";
								
        					})
    					}
    					else{
    						innerVolunteersHtml = "봉사자 없음";
    					}
    				}
    				finally{
    					$('#userList').html(innerUsersHtml);	
    					userList = clickedUsers;
    					$('#volunteerList').html(innerVolunteersHtml);
    					volunteerList = clickedVolunteers;
    					$('#manager').text(data.managerName);
    				}
            	});	
    		}
    	})
    	
    	$('#cancelUserGroupBtn').click(function(){
    		
    		$('#editUsers').toggle();
			if(userList.length != 0){
				userList.forEach(function(item){
					$('#editUsers ul li input[value="'+ item +'"]').prop('checked', true);
					$('#editVolunteers ul li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#editUsers ul li input').each(function(){
	    			if($(this).prop('checked')){
	    				$(this).prop('checked', false);
						$('#editVolunteers ul li input[value="'+ $(this).val() +'"]').prop('disabled', false);
	    			}
	    		})
			}
    		$('#userList').toggle();
    		$('#users').html("");
    		$('#searchUsers').val("");
    		$('#pagingUsers').html("");
    		clickedUsers = userList;
    		
    		$('#editVolunteers').toggle();
			if(volunteerList.length != 0){
				volunteerList.forEach(function(item){
					$('#editVolunteers ul li input[value="'+ item +'"]').prop('checked', true);
					$('#editUsers ul li input[value="'+ item +'"]').prop('disabled', true);
				})
			}
			else{
				$('#editVolunteers ul li input').each(function(){
	    			if($(this).prop('checked')){
	    				$(this).prop('checked', false);
						$('#editUsers ul li input[value="'+ $(this).val() +'"]').prop('disabled', false);
	    			}
	    		})
			}
			$('#volunteerList').toggle();
			$('#volunteers').html("");
    		$('#searchVolunteers').val("");
    		$('#pagingVolunteers').html("");
    		clickedVolunteers = volunteerList;
    		
    		$('#editManager').toggle();
			$('#editManager').val(managerValue);
    		$('#manager').toggle();
    		
    		$('#cancelUserGroupBtn').toggle();
    		$('#editUserGroupBtn').html('편집');
    	})
    	
    	/*var deliveryValue;
    	
    	$('#editDeliveryButton').click(function() {
    		
    		deliveryValue = $('input[name="delivery"]:checked').val();
    		
    		$('#editDelivery').toggle();
    		
    		$('#delivery').toggle();
    		
    		$('#cancelDeliveryButton').toggle();
    		
    		if($('#editDeliveryButton').html() == '수정'){
    			$('#editDeliveryButton').html('완료');
    		}
    		else{
    			$('#editDeliveryButton').html('수정');
    			$.post("/activitydata/setDelivery", {id: $('#activityId').val(), delivery: deliveryValue}, function(data) {
    				if(data == 0){
    					$('#delivery').text("직접 수령");
    				}
    				else{
    					$('#delivery').text("봉사자 통해 전달");	
    				}
    				
            	});	
    		}
    	})
    	
    	$('#cancelDeliveryButton').click(function(){
			$('#editDelivery').toggle();
			$('#editDelivery input[value="'+ deliveryValue +'"]').prop('checked', true);
    		$('#delivery').toggle();
    		$('#cancelDeliveryButton').toggle();
    		$('#editDeliveryButton').html('수정');
    	})*/
    	
    	/*var phoneAgreeValue;
    	
    	$('#editPhoneAgreeButton').click(function() {
    		
    		phoneAgreeValue = $('input[name="phoneAgree"]:checked').val();
    		
    		$('#editPhoneAgree').toggle();
    		
    		$('#phoneAgree').toggle();
    		
    		$('#cancelPhoneAgreeButton').toggle();
    		
    		if($('#editPhoneAgreeButton').html() == '수정'){
    			$('#editPhoneAgreeButton').html('완료');
    		}
    		else{
    			$('#editPhoneAgreeButton').html('수정');
    			$.post("/activitydata/setPhoneAgree", {id: $('#activityId').val(), phoneAgree: phoneAgreeValue}, function(data) {
    				if(data == ""){
    					$('#phoneAgree').text("X");
    				}
    				else{
    					$('#phoneAgree').text("O");	
    				}
            	});	
    		}
    	})
    	
    	$('#cancelPhoneAgreeButton').click(function(){
			$('#editPhoneAgree').toggle();
			if(phoneAgreeValue==null){
				$('input[name="phoneAgree"]').prop('checked', false);
			}
			else{
				$('input[name="phoneAgree"]').prop('checked', true);
			}
    		$('#phoneAgree').toggle();
    		$('#cancelPhoneAgreeButton').toggle();
    		$('#editPhoneAgreeButton').html('수정');
    	})
    	*/
    	
    	/*var startDate;
    	var startTime;
    	var endDate;
    	var endTime;
    	
    	$('#editVolunteerTimeButton').click(function() {
    		
    		startDate = $('input[name="startDate"]').val();
			startTime = $('input[name="startTime"]').val();
			endDate = $('input[name="endDate"]').val();
			endTime = $('input[name="endTime"]').val();
    		
    		$('#editVolunteerTime').toggle();
    		
    		$('#volunteerTime').toggle();
    		
    		$('#cancelVolunteerTimeButton').toggle();
    		
    		if($('#editVolunteerTimeButton').html() == '수정'){
    			$('#editVolunteerTimeButton').html('완료');
    		}
    		else{
    			$('#editVolunteerTimeButton').html('수정');
    			$.post("/activitydata/setVolunteerTime", 
    				{ id: $('#activityId').val(), 
    				  startDate: startDate, 
    				  startTime: startTime,
    				  endDate: endDate,
    				  endTime: endTime
    				}, 
    				function(data) {
    					var arr = data.split(".");
    					var start = (arr[0] === "" || arr[1] === "")?"시작 시간 없음":arr[0] + " " + arr[1];
    					var end = (arr[2] === "" || arr[3] === "")?"끝 시간 없음":arr[2] + " " + arr[3];
    					$('#volunteerTime').text(start + " ~ " + end);
            	});	
    		}
    	})
    	
    	$('#cancelVolunteerTimeButton').click(function(){
			$('#editVolunteerTime').toggle();
			var volunteerTimeText = $('#volunteerTime').text();
			
			if(volunteerTimeText.includes("시작 시간 없음") && volunteerTimeText.includes("끝 시간 없음")){
				$('input[name="startDate"]').val("");
				$('input[name="startTime"]').val("");
				$('input[name="endDate"]').val("");
				$('input[name="endTime"]').val("");
			}
			else if(volunteerTimeText.includes("시작 시간 없음")){
				$('input[name="startDate"]').val("");
				$('input[name="startTime"]').val("");
				$('input[name="endDate"]').val(endDate);
				$('input[name="endTime"]').val(endTime);
			}
			else if(volunteerTimeText.includes("끝 시간 없음")){
				$('input[name="startDate"]').val(startDate);
				$('input[name="startTime"]').val(startTime);
				$('input[name="endDate"]').val("");
				$('input[name="endTime"]').val("");
			}
			else{
				$('input[name="startDate"]').val(startDate);
				$('input[name="startTime"]').val(startTime);
				$('input[name="endDate"]').val(endDate);
				$('input[name="endTime"]').val(endTime);
			}
			
    		$('#volunteerTime').toggle();
    		$('#cancelVolunteerTimeButton').toggle();
    		$('#editVolunteerTimeButton').html('수정');
    	})
    	
    	$('#editPlaceButton').click(function() {
    		
    		$('#editPlace').toggle();
    		
    		$('#place').toggle();
    		
    		$('#cancelPlaceButton').toggle();
    		
    		if($('#editPlaceButton').html() == '수정'){
    			$('#editPlaceButton').html('완료');
    		} else{
    			$('#editPlaceButton').html('수정');

    			$.post("/activitydata/setPlace", {
    				id: $('#activityId').val(),
					place: $('#address').val()
				}, function(data) {
    				if(data !== ""){
    					$('#place').text(data);
    				}
    				else{
    					$('#place').text("장소 없음");
    				}

            	});
				var y = document.getElementById("coordi_y").value;
				var x = document.getElementById("coordi_x").value;
    			changeMap(y, x);
    		}
    	})
    	
    	$('#cancelPlaceButton').click(function(){
			$('#editPlace').toggle();
			var placeText = $('#place').text();
			if(placeText == "장소 없음"){
				$('#editPlace').val("");
			}
			else{
				$('#editPlace').val($('#place').text());
			}
    		$('#place').toggle();
    		$('#cancelPlaceButton').toggle();
    		$('#editPlaceButton').html('수정');
    	})
    	
    	$('#editContentButton').click(function() {
    		
    		$('#editContent').toggle();
    		
    		$('#content').toggle();
    		
    		$('#cancelContentButton').toggle();
    		
    		if($('#editContentButton').html() == '수정'){
    			$('#editContentButton').html('완료');
    		}
    		else{
    			$('#editContentButton').html('수정');
    			$.post("/activitydata/setContent", {id: $('#activityId').val(), content: $('#editContent').val()}, function(data) {
    				if(data !== ""){
    					$('#content').text(data);
    				}
    				else{
    					$('#content').text("세부내용 없음");
    				}
            	});	
    		}
    	})
    	
    	$('#cancelContentButton').click(function(){
			$('#editContent').toggle();
			var contentText = $('#content').text();
			if(contentText == "세부내용 없음"){
				$('#editContent').val("");
			}
			else{
				$('#editContent').val($('#content').text());
			}
    		$('#content').toggle();
    		$('#cancelContentButton').toggle();
    		$('#editContentButton').html('수정');
    	})*/
    	
    	var startDate;
    	var startTime;
    	var endDate;
    	var endTime;
    	
    	$('#editActivityGroupBtn').click(function() {
    		
    		startDate = $('input[name="startDate"]').val();
			startTime = $('input[name="startTime"]').val();
			endDate = $('input[name="endDate"]').val();
			endTime = $('input[name="endTime"]').val();
    		
    		$('#editVolunteerTime').toggle();
    		
    		$('#volunteerTime').toggle();
    		
			$('#editPlace').toggle();
    		
    		$('#place').toggle();
    		
			$('#editContent').toggle();
    		
    		$('#content').toggle();
    		
    		$('#cancelActivityGroupBtn').toggle();
    		
    		if($('#editActivityGroupBtn').html() == '편집'){
    			$('#editActivityGroupBtn').html('완료');
    		}
    		else{
    			$('#editActivityGroupBtn').html('편집');
    			$.post("/activitydata/setVolunteerTimeAndPlaceAndContent", 
    				{ id: $('#activityId').val(), 
    				  startDate: startDate, 
    				  startTime: startTime,
    				  endDate: endDate,
    				  endTime: endTime,
    				  place: $('#address').val(),
    				  content: $('#editContent').val()
    				}, 
    				function(data) {
    					var arr = data.split("|");
    					if(arr[0] !== ""){
        					$('#place').text(arr[0]);
        				}
        				else{
        					$('#place').text("장소 없음");
        				}
    					if(arr[1] !== ""){
        					$('#content').text(arr[1]);
        				}
        				else{
        					$('#content').text("세부내용 없음");
        				}
    					
    					var start = (arr[2] === "" || arr[3] === "")?"시작 시간 없음":arr[2] + " " + arr[3];
    					var end = (arr[4] === "" || arr[5] === "")?"끝 시간 없음":arr[4] + " " + arr[5];
    					$('#volunteerTime').text(start + " ~ " + end);
            	});	
    			var y = document.getElementById("coordi_y").value;
				var x = document.getElementById("coordi_x").value;
    			changeMap(y, x);
    		}
    	})
    	
    	$('#cancelActivityGroupBtn').click(function(){
			$('#editVolunteerTime').toggle();
			var volunteerTimeText = $('#volunteerTime').text();
			
			if(volunteerTimeText.includes("시작 시간 없음") && volunteerTimeText.includes("끝 시간 없음")){
				$('input[name="startDate"]').val("");
				$('input[name="startTime"]').val("");
				$('input[name="endDate"]').val("");
				$('input[name="endTime"]').val("");
			}
			else if(volunteerTimeText.includes("시작 시간 없음")){
				$('input[name="startDate"]').val("");
				$('input[name="startTime"]').val("");
				$('input[name="endDate"]').val(endDate);
				$('input[name="endTime"]').val(endTime);
			}
			else if(volunteerTimeText.includes("끝 시간 없음")){
				$('input[name="startDate"]').val(startDate);
				$('input[name="startTime"]').val(startTime);
				$('input[name="endDate"]').val("");
				$('input[name="endTime"]').val("");
			}
			else{
				$('input[name="startDate"]').val(startDate);
				$('input[name="startTime"]').val(startTime);
				$('input[name="endDate"]').val(endDate);
				$('input[name="endTime"]').val(endTime);
			}
			
    		$('#volunteerTime').toggle();
    		
    		$('#editPlace').toggle();
			var placeText = $('#place').text();
			if(placeText == "장소 없음"){
				$('#address').val("");
			}
			else{
				$('#address').val($('#place').text());
			}
    		$('#place').toggle();
    		
    		$('#editContent').toggle();
			var contentText = $('#content').text();
			if(contentText == "세부내용 없음"){
				$('#editContent').val("");
			}
			else{
				$('#editContent').val($('#content').text());
			}
    		$('#content').toggle();
    		
    		$('#cancelActivityGroupBtn').toggle();
    		$('#editActivityGroupBtn').html('편집');
    	})
    	
    	/*var deadlineDate;
    	var deadlineTime;
    	
    	$('#editDeadlineButton').click(function() {
    		
    		deadlineDate = $('input[name="deadlineDate"]').val(); 
			deadlineTime = $('input[name="deadlineTime"]').val();
    		
    		$('#editDeadline').toggle();
    		
    		$('#deadline').toggle();
    		
    		$('#cancelDeadlineButton').toggle();
    		
    		if($('#editDeadlineButton').html() == '수정'){
    			$('#editDeadlineButton').html('완료');
    		}
    		else{
    			$('#editDeadlineButton').html('수정');
    			$.post("/activitydata/setDeadline", 
    				{ id: $('#activityId').val(), 
    				  deadlineDate: deadlineDate, 
    				  deadlineTime: deadlineTime
    				}, 
    				function(data) {
    					var arr = data.split(".");
    					$('#deadline').text((arr[0] === "" || arr[1] === "")?"마감시간 없음":arr[0] + " " + arr[1]);
            	});	
    		}
    	})
    	
    	$('#cancelDeadlineButton').click(function(){
			$('#editDeadline').toggle();
			var deadlineText = $('#deadline').text();
			
			if(deadlineText.includes("마감시간 없음")){
				$('input[name="deadlineDate"]').val("");
				$('input[name="deadlineTime"]').val("");
			}
			else{
				$('input[name="deadlineDate"]').val(deadlineDate);
				$('input[name="deadlineTime"]').val(deadlineTime);
			}
			
    		$('#deadline').toggle();
    		$('#cancelDeadlineButton').toggle();
    		$('#editDeadlineButton').html('수정');
    	})*/
    	
    	
    	/*$('input[name="userId"]').each(function(){
				
    		if($(this).prop('checked')){
    			$('#editVolunteers li input[value="'+ $(this).val() +'"]').prop('disabled', true);
    		}
    		
			$(this).click(function(){
				$('#editVolunteers li input[value="'+ $(this).val() +'"]').prop('disabled', function(i, v) { return !v; });
			})
				
		})
			
		$('input[name="volunteerId"]').each(function(){
				
			if($(this).prop('checked')){
    			$('#editUsers li input[value="'+ $(this).val() +'"]').prop('disabled', true);
    		}
			
			$(this).click(function(){
				$('#editUsers li input[value="'+ $(this).val() +'"]').prop('disabled', function(i, v) { return !v; });
			})
				
		})*/
		
    </script>

	<div lang="en" th:replace="common/footer :: footer"></div>
	</div>
</body>
</html>